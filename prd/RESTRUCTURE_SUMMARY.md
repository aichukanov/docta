# Реструктуризация PRD: Разделение auth на модульные PRD

**Дата:** 2026-01-29  
**Причина:** Большой auth PRD (10 итераций) был слишком широким и включал функциональность, относящуюся к разным доменам (авторизация, профили, клиники, модерация).

---

## Что было сделано

### 1. Упрощен auth PRD

**Было:** 10 итераций (авторизация + профили + клиники + модерация)  
**Стало:** 4 итерации (только базовая авторизация через OAuth)

**Что осталось в auth:**

- ✅ База данных (users, oauth_accounts, sessions)
- ✅ OAuth авторизация (Google, Telegram)
- ✅ Вход/Выход из системы
- ✅ Блок пользователя в хэдере (аватар, dropdown)
- ✅ Базовый middleware

**Что удалено из auth:**

- ❌ Итерация 5: Профиль пользователя → вынесено в **user-profile**
- ❌ Итерация 6: CRUD клиник → вынесено в **clinic-profile**
- ❌ Итерация 7: Верификация через OAuth → вынесено в **clinic-verification**
- ❌ Итерация 8: Запросы на присоединение → вынесено в **clinic-verification**
- ❌ Итерация 9: Админ панель → вынесено в **admin-panel**
- ❌ Итерация 10: Управление пользователями → вынесено в **clinic-verification**

### 2. Созданы новые PRD (в планировании)

**Создано 7 новых PRD:**

1. **user-profile** - Профиль пользователя
2. **doctor-profile** - Профиль врача
3. **clinic-profile** - Профиль клиники
4. **clinic-verification** - Верификация и модерация клиник
5. **permissions** - Система прав и ролей
6. **admin-panel** - Административная панель
7. **comments** - Комментарии и отзывы

### 3. Создана документация

- **PRD_STRUCTURE.md** - полная структура всех PRD с зависимостями
- **README.md** - обновлен с новой структурой и списком PRD
- Все файлы auth PRD обновлены (index, PROGRESS, requirements, database, iterations)

---

## Преимущества новой структуры

### ✅ Модульность

- Каждый PRD отвечает за свою предметную область
- Можно разрабатывать параллельно
- Легче тестировать и верифицировать

### ✅ Ясность

- Четкие границы ответственности
- Меньше когнитивной нагрузки
- Проще найти нужную функциональность

### ✅ Управляемость

- Короткие итерации (4-6 вместо 10)
- Быстрее достигать завершенности
- Легче оценивать прогресс

### ✅ Гибкость

- Можно менять приоритеты PRD независимо
- Легче вносить изменения в один домен
- Не ломается вся система при изменениях

---

## Новая структура

```
prd/
├── README.md (обновлен)
├── PRD_STRUCTURE.md (создан)
├── TEMPLATE.md
│
├── auth/ (упрощен: 4 итерации)
│   ├── index.md
│   ├── PROGRESS.md
│   ├── 01-05 секции
│   └── iterations/ (4 файла)
│
└── [7 новых PRD в планировании]
    ├── user-profile/
    ├── doctor-profile/
    ├── clinic-profile/
    ├── clinic-verification/
    ├── permissions/
    ├── admin-panel/
    └── comments/
```

---

## Зависимости между PRD

```
auth (P0)
├── permissions (P1)
├── user-profile (P1)
│   ├── doctor-profile (P1)
│   └── clinic-profile (P1)
│       └── clinic-verification (P2)
│           └── admin-panel (P2)
└── comments (P3)
```

---

## Ключевые изменения в auth PRD

### База данных

**Было:** 7 таблиц (users, oauth_accounts, sessions, clinic_users, clinic_join_requests, audit_logs, clinic_verified_contacts)  
**Стало:** 3 таблицы (users, oauth_accounts, sessions)

### Требования

**Было:** FR-1 до FR-32 (32 требования)  
**Стало:** FR-1 до FR-19 (19 требований)

### Итерации

**Было:** 10 итераций  
**Стало:** 4 итерации

---

## Новые требования к будущим PRD

### Обязательно включить:

**user-profile:**

- Управление OAuth привязками (список, добавление, удаление)
- Публичный/приватный профиль
- Маскировка email для комментариев (x**\***@g\***_._**)

**doctor-profile:**

- Описание с Markdown поддержкой
- Публичная страница врача
- Предпросмотр изменений

**clinic-profile:**

- Описание с Markdown поддержкой
- Публичная страница клиники
- Предпросмотр изменений
- Draft/Published режимы

---

## Что будет добавлено в auth позже

В будущих итерациях auth PRD:

- Email/password регистрация
- Страницы sign-in, sign-out, reset-password
- Восстановление пароля
- Подтверждение email
- Двухфакторная аутентификация (2FA)

---

## Следующие шаги

1. ✅ Упрощен auth PRD
2. ✅ Создана структура PRD_STRUCTURE.md
3. ⏳ Начать разработку auth PRD (4 итерации)
4. ⏳ Создать user-profile PRD (детально)
5. ⏳ Создать doctor-profile PRD (детально)
6. ⏳ Создать clinic-profile PRD (детально)
7. ⏳ Создать остальные PRD по мере необходимости

---

## Метрики

**До реструктуризации:**

- 1 PRD × 10 итераций = ~10-12 недель на полную реализацию
- Сложно параллелить разработку
- Высокая когнитивная нагрузка

**После реструктуризации:**

- 8 PRD × 4-6 итераций каждый
- Можно разрабатывать 2-3 PRD параллельно
- Быстрее достигать промежуточных результатов
- Легче менять приоритеты

---

**См. также:** [PRD_STRUCTURE.md](PRD_STRUCTURE.md) для полной структуры всех PRD.
