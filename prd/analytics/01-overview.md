# 1. Обзор

## Цель

Внедрить комплексную систему аналитики на базе Mixpanel для сбора данных о поведении пользователей, отслеживания ключевых метрик и принятия data-driven решений по развитию платформы.

## Контекст

### Проблема

На данный момент у нас нет инструментов для понимания:

- Как пользователи взаимодействуют с платформой
- Какие страницы наиболее популярны
- Какие клиники и врачи получают наибольшее внимание
- Конвертируются ли просмотры в реальные действия (звонки, переходы на сайты)
- Какие источники трафика наиболее эффективны
- Где пользователи испытывают трудности (drop-off points)

### Решение

Интегрировать **двойную систему аналитики** для максимального покрытия:

#### Mixpanel - для product аналитики:

- Отслеживание всех значимых действий пользователей
- Построение воронок конверсии
- Сегментация пользователей
- Когортный анализ
- A/B тестирование (в будущем)

#### Google Analytics 4 - для маркетинга и SEO:

- Общий веб-трафик и источники
- Органический поиск и SEO метрики
- Интеграция с Google Ads
- Демографические данные
- Стандартные отчеты для стейкхолдеров

### Почему два инструмента?

**Mixpanel и GA4 дополняют друг друга:**

| Аспект            | Mixpanel                | Google Analytics 4           |
| ----------------- | ----------------------- | ---------------------------- |
| **Фокус**         | Product & User behavior | Marketing & Traffic          |
| **Использование** | Product team            | Marketing & Management       |
| **Сила**          | Event tracking, Funnels | SEO, Acquisition, Демография |
| **Стоимость**     | Free tier generous      | Полностью бесплатен          |
| **Отчеты**        | Продуктовые метрики     | Стандартные бизнес-отчеты    |

### Преимущества Mixpanel

✅ **Event-based аналитика** - идеально для SaaS/marketplace  
✅ **Профили пользователей** - связывание всех действий с user ID  
✅ **Воронки и retention** - out-of-the-box инструменты  
✅ **Segmentation** - мощные возможности сегментации  
✅ **Real-time** - данные доступны сразу  
✅ **Privacy-compliant** - GDPR ready  
✅ **Generous free tier** - до 100K tracked users/month

### Преимущества Google Analytics 4

✅ **Полностью бесплатен** - нет лимитов на события  
✅ **Google Ads интеграция** - связь с рекламными кампаниями  
✅ **Google Search Console** - SEO данные из первых рук  
✅ **Демографические данные** - возраст, пол, интересы  
✅ **Стандартные отчеты** - привычные всем форматы  
✅ **Знаком всем** - не нужно обучать команду  
✅ **Attribution modeling** - мультиканальная атрибуция

### Альтернативы (не выбраны)

- **Amplitude** - дороже Mixpanel, избыточен для текущих задач
- **PostHog** - требует self-hosting для полноценного использования
- **Plausible** - слишком простой, не хватает функциональности
- **Только GA4** - недостаточно для глубокой product аналитики
- **Только Mixpanel** - не хватает маркетинговых метрик

## Целевая аудитория

### Внутренние пользователи (команда)

1. **Product Manager** - анализ метрик, принятие решений
2. **Marketing** - эффективность рекламных кампаний, источники трафика
3. **Developers** - отслеживание ошибок, performance проблем
4. **Business Analyst** - построение отчетов, forecasting

### Отслеживаемые сегменты пользователей

1. **Анонимные посетители** - до авторизации
2. **Зарегистрированные пользователи** - после авторизации
3. **Владельцы клиник** - отдельные метрики для B2B
4. **Врачи** - поведение профессионалов
5. **Пациенты** - основная целевая аудитория

## Границы проекта (Scope)

### В рамках этого PRD

✅ Настройка и интеграция Mixpanel SDK  
✅ Настройка и интеграция Google Analytics 4  
✅ Трэкинг всех основных событий (page views, clicks, interactions)  
✅ Профили пользователей (identify на основе auth)  
✅ Базовые funnels и cohorts (Mixpanel)  
✅ Стандартные отчеты (GA4)  
✅ Cookie consent интеграция  
✅ Type-safe event tracking  
✅ Документация событий и best practices

### Вне рамок (будет реализовано позже)

❌ Server-side tracking (только client-side пока)  
❌ Google Ads интеграция (настроим после запуска рекламы)  
❌ Data warehouse интеграция (Snowflake, BigQuery)  
❌ Custom analytics dashboard  
❌ Real-time alerts  
❌ Advanced ML/AI insights  
❌ Session replay  
❌ Heatmaps

## Предположения

1. **GDPR/Privacy** - у нас будет cookie consent mechanism
2. **User Authentication** - auth система уже реализована (auth PRD)
3. **Page Structure** - основные страницы (клиники, врачи, услуги) уже существуют
4. **Traffic Volume** - укладываемся в free tier Mixpanel (100K users/month)
5. **Development Team** - разработчики понимают event-driven analytics

## Ограничения

### Технические

- **Client-side only** - пока не внедряем server-side tracking
- **No retroactive data** - данные собираются только с момента внедрения
- **Browser restrictions** - ad blockers могут блокировать Mixpanel
- **Cookie consent** - трэкинг только после согласия пользователя

### Бизнес

- **Free tier limits** - 100K tracked users/month, 20M events/month
- **Data retention** - Mixpanel хранит данные ограниченное время на free tier
- **Export limitations** - экспорт данных ограничен на free tier

### Privacy/Legal

- **GDPR compliance** - необходимо согласие на cookies
- **Personal data** - не храним sensitive данные в событиях
- **Right to be forgotten** - должна быть возможность удалить данные пользователя

## Критерии успеха

### Технические

- ✅ Mixpanel SDK успешно интегрирован и работает на всех страницах
- ✅ 100% критичных событий отслеживаются корректно
- ✅ Нет ошибок в консоли связанных с аналитикой
- ✅ Performance impact < 50ms на page load

### Бизнес

- ✅ Собираем данные по всем ключевым метрикам
- ✅ Можем построить conversion funnels для top 3 user journeys
- ✅ Можем сегментировать пользователей по 5+ параметрам
- ✅ Данные используются для принятия минимум 1 product решения в месяц

### User Experience

- ✅ Аналитика не влияет на скорость работы сайта
- ✅ Cookie consent работает корректно
- ✅ Пользователь может opt-out из трэкинга

## Риски

См. **[05-risks-and-metrics.md](05-risks-and-metrics.md)**
