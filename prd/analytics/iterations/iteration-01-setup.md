# –ò—Ç–µ—Ä–∞—Ü–∏—è 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Mixpanel, GA4 –∏ –±–∞–∑–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è

**–°—Ç–∞—Ç—É—Å:** üî¥ Not Started  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0 (–∫—Ä–∏—Ç–∏—á–Ω–æ)  
**–û—Ü–µ–Ω–∫–∞:** 4-5 –¥–Ω–µ–π

---

## –¶–µ–ª—å

–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –±–∞–∑–æ–≤—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –¥–≤–æ–π–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å Mixpanel SDK –∏ Google Analytics 4, —Å–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—ã–π composable –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏–π –≤ –æ–±–∞ —Å–µ—Ä–≤–∏—Å–∞, –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å cookie consent.

---

## Scope

### –í —Ä–∞–º–∫–∞—Ö –∏—Ç–µ—Ä–∞—Ü–∏–∏

‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Mixpanel SDK  
‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Google Analytics 4  
‚úÖ Nuxt plugins –¥–ª—è client-side –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–±–æ–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤  
‚úÖ Unified composable `useAnalytics()` —Å –±–∞–∑–æ–≤—ã–º–∏ –º–µ—Ç–æ–¥–∞–º–∏  
‚úÖ TypeScript —Ç–∏–ø—ã –¥–ª—è —Å–æ–±—ã—Ç–∏–π –∏ —Å–≤–æ–π—Å—Ç–≤  
‚úÖ Cookie consent –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è  
‚úÖ Debug mode –¥–ª—è development  
‚úÖ Environment configuration  
‚úÖ Event mapping –º–µ–∂–¥—É Mixpanel –∏ GA4  
‚úÖ Error handling –∏ graceful degradation  
‚úÖ –ë–∞–∑–æ–≤–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –í–Ω–µ —Ä–∞–º–æ–∫

‚ùå –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (–±—É–¥—É—Ç –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –∏—Ç–µ—Ä–∞—Ü–∏—è—Ö)  
‚ùå –í–æ—Ä–æ–Ω–∫–∏ –∏ dashboards (–∏—Ç–µ—Ä–∞—Ü–∏—è 4)  
‚ùå Server-side tracking  
‚ùå Advanced features (cohorts, experiments)  
‚ùå Google Ads –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

---

## –ó–∞–¥–∞—á–∏

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º

**–ó–∞–¥–∞—á–∞ 1.1:** –°–æ–∑–¥–∞—Ç—å Mixpanel project

- [ ] –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ mixpanel.com (free tier)
- [ ] –°–æ–∑–¥–∞—Ç—å project "Docta.me - Production"
- [ ] –°–æ–∑–¥–∞—Ç—å project "Docta.me - Development" (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å Project Token

**–ó–∞–¥–∞—á–∞ 1.2:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Mixpanel project settings

- [ ] –í–∫–ª—é—á–∏—Ç—å GDPR mode –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å data residency (EU –∏–ª–∏ US)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å session timeout (30 –º–∏–Ω—É—Ç)

**–ó–∞–¥–∞—á–∞ 1.3:** –°–æ–∑–¥–∞—Ç—å Google Analytics 4 property

- [ ] –ó–∞–π—Ç–∏ –≤ Google Analytics (analytics.google.com)
- [ ] –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π property "Docta.me"
- [ ] –°–æ–∑–¥–∞—Ç—å Data Stream –¥–ª—è –≤–µ–±-—Å–∞–π—Ç–∞
- [ ] –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å Measurement ID (G-XXXXXXXXXX)

**–ó–∞–¥–∞—á–∞ 1.4:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å GA4 property settings

- [ ] –í–∫–ª—é—á–∏—Ç—å Google Signals (–¥–ª—è demographics data)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Data retention (14 months recommended)
- [ ] –í–∫–ª—é—á–∏—Ç—å Enhanced measurement
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å IP anonymization (GDPR compliance)

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤

**–ó–∞–¥–∞—á–∞ 2.1:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å dependencies

```bash
npm install mixpanel-browser
npm install -D @types/mixpanel-browser
# GA4 —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ gtag.js CDN, –Ω–µ –Ω—É–∂–µ–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π npm –ø–∞–∫–µ—Ç
```

### 3. Environment Configuration

**–ó–∞–¥–∞—á–∞ 3.1:** –î–æ–±–∞–≤–∏—Ç—å –≤ `.env`

```bash
# .env
MIXPANEL_TOKEN=your_production_mixpanel_token_here
GA4_MEASUREMENT_ID=G-XXXXXXXXXX
ANALYTICS_ENABLED=true
```

**–ó–∞–¥–∞—á–∞ 3.2:** –î–æ–±–∞–≤–∏—Ç—å –≤ `.env.development`

```bash
# .env.development
MIXPANEL_TOKEN=your_development_mixpanel_token_here
GA4_MEASUREMENT_ID=G-YYYYYYYYYY  # –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –¥–ª—è dev
ANALYTICS_ENABLED=true
ANALYTICS_DEBUG=true
```

**–ó–∞–¥–∞—á–∞ 3.3:** –û–±–Ω–æ–≤–∏—Ç—å `nuxt.config.ts`

```typescript
export default defineNuxtConfig({
	runtimeConfig: {
		public: {
			mixpanelToken: process.env.MIXPANEL_TOKEN || '',
			ga4MeasurementId: process.env.GA4_MEASUREMENT_ID || '',
			analyticsEnabled: process.env.ANALYTICS_ENABLED === 'true',
			analyticsDebug: process.env.ANALYTICS_DEBUG === 'true',
			environment: process.env.NODE_ENV || 'development',
		},
	},
});
```

### 4. TypeScript Types

**–ó–∞–¥–∞—á–∞ 4.1:** –°–æ–∑–¥–∞—Ç—å `types/analytics.ts`

```typescript
// Base types
export type EventName = string; // Will expand in next iterations

export interface BaseEventProperties {
	timestamp?: string;
	page_url?: string;
	page_title?: string;
	page_path?: string;
	[key: string]: any;
}

export interface UserProperties {
	$name?: string;
	$email?: string;
	role?: 'patient' | 'clinic_owner' | 'doctor';
	city?: string;
	created_at?: string;
	[key: string]: any;
}

export interface SuperProperties {
	platform: 'web' | 'mobile_web';
	environment: 'production' | 'staging' | 'development';
	app_version?: string;
	[key: string]: any;
}

// Analytics interface
export interface Analytics {
	trackEvent: (eventName: EventName, properties?: BaseEventProperties) => void;
	trackPageView: (pageName: string, properties?: BaseEventProperties) => void;
	identifyUser: (userId: string, properties?: UserProperties) => void;
	setUserProperty: (key: string, value: any) => void;
	incrementUserProperty: (key: string, by?: number) => void;
	reset: () => void;
	optOut: () => void;
	optIn: () => void;
}

// GA4 types
export interface GA4Config {
	send_page_view?: boolean;
	anonymize_ip?: boolean;
	cookie_flags?: string;
}
```

### 5. Mixpanel Plugin

**–ó–∞–¥–∞—á–∞ 5.1:** –°–æ–∑–¥–∞—Ç—å `plugins/mixpanel.client.ts`

```typescript
import mixpanel from 'mixpanel-browser';

export default defineNuxtPlugin(async (nuxtApp) => {
	const config = useRuntimeConfig();

	// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤–∫–ª—é—á–µ–Ω–∞ –ª–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
	if (!config.public.analyticsEnabled || !config.public.mixpanelToken) {
		console.warn(
			'[Analytics/Mixpanel] Analytics is disabled or token is missing',
		);
		return {
			provide: {
				mixpanel: null,
			},
		};
	}

	// –ü—Ä–æ–≤–µ—Ä—è–µ–º cookie consent
	const { hasConsent } = useCookieConsent();
	if (!hasConsent.value) {
		console.log('[Analytics/Mixpanel] Waiting for cookie consent');
		return {
			provide: {
				mixpanel: null,
			},
		};
	}

	try {
		// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Mixpanel
		mixpanel.init(config.public.mixpanelToken, {
			debug: config.public.analyticsDebug,
			track_pageview: false, // Manual tracking
			persistence: 'localStorage',
			ignore_dnt: false,
			api_host: 'https://api-eu.mixpanel.com', // EU endpoint for GDPR
			loaded: (mixpanel) => {
				console.log('[Analytics/Mixpanel] Loaded successfully');
			},
		});

		// –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º super properties
		mixpanel.register({
			platform: 'web',
			environment: config.public.environment,
			app_version: '1.0.0', // TODO: Get from package.json
		});

		// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
		const { user } = useAuth();
		if (user?.value) {
			mixpanel.identify(user.value.id);
			mixpanel.people.set({
				$name: user.value.name,
				$email: user.value.email,
			});
		}
	} catch (error) {
		console.error('[Analytics/Mixpanel] Failed to initialize:', error);
	}

	return {
		provide: {
			mixpanel,
		},
	};
});
```

### 6. Google Analytics 4 Plugin

**–ó–∞–¥–∞—á–∞ 6.1:** –°–æ–∑–¥–∞—Ç—å `plugins/gtag.client.ts`

```typescript
export default defineNuxtPlugin((nuxtApp) => {
	const config = useRuntimeConfig();

	if (!config.public.analyticsEnabled || !config.public.ga4MeasurementId) {
		console.warn(
			'[Analytics/GA4] Analytics is disabled or measurement ID is missing',
		);
		return {
			provide: {
				gtag: null,
			},
		};
	}

	// –ü—Ä–æ–≤–µ—Ä—è–µ–º cookie consent
	const { hasConsent } = useCookieConsent();
	if (!hasConsent.value) {
		console.log('[Analytics/GA4] Waiting for cookie consent');
		return {
			provide: {
				gtag: null,
			},
		};
	}

	try {
		// –ó–∞–≥—Ä—É–∂–∞–µ–º gtag.js
		const script = document.createElement('script');
		script.async = true;
		script.src = `https://www.googletagmanager.com/gtag/js?id=${config.public.ga4MeasurementId}`;
		document.head.appendChild(script);

		// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º dataLayer –∏ gtag function
		window.dataLayer = window.dataLayer || [];
		function gtag(...args: any[]) {
			window.dataLayer.push(args);
		}

		gtag('js', new Date());
		gtag('config', config.public.ga4MeasurementId, {
			send_page_view: false, // Manual page view tracking
			anonymize_ip: true, // GDPR compliance
			cookie_flags: 'SameSite=None;Secure',
		});

		// –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º user_id
		const { user } = useAuth();
		if (user?.value) {
			gtag('set', 'user_properties', {
				user_id: user.value.id,
				user_role: user.value.role,
			});
		}

		console.log('[Analytics/GA4] Loaded successfully');

		return {
			provide: {
				gtag,
			},
		};
	} catch (error) {
		console.error('[Analytics/GA4] Failed to initialize:', error);
		return {
			provide: {
				gtag: null,
			},
		};
	}
});

// Type declaration for window.dataLayer
declare global {
	interface Window {
		dataLayer: any[];
	}
}
```

### 7. Unified Analytics Composable

**–ó–∞–¥–∞—á–∞ 7.1:** –°–æ–∑–¥–∞—Ç—å `composables/useAnalytics.ts`

```typescript
import type {
	Analytics,
	EventName,
	BaseEventProperties,
	UserProperties,
} from '~/types/analytics';

export const useAnalytics = (): Analytics => {
	const { $mixpanel, $gtag } = useNuxtApp();
	const config = useRuntimeConfig();
	const route = useRoute();

	const isEnabled = computed(() => {
		return config.public.analyticsEnabled;
	});

	const trackEvent = (
		eventName: EventName,
		properties?: BaseEventProperties,
	) => {
		if (!isEnabled.value) return;

		try {
			const enrichedProps = {
				...properties,
				timestamp: new Date().toISOString(),
				page_url: window.location.href,
				page_title: document.title,
				page_path: route.path,
			};

			// Track in Mixpanel
			if ($mixpanel) {
				$mixpanel.track(eventName, enrichedProps);
			}

			// Track in GA4
			if ($gtag) {
				const ga4EventName = mapToGA4EventName(eventName);
				const ga4Props = mapToGA4Properties(enrichedProps);
				$gtag('event', ga4EventName, ga4Props);
			}

			if (config.public.analyticsDebug) {
				console.log('[Analytics] Event tracked:', eventName, enrichedProps);
			}
		} catch (error) {
			console.error('[Analytics] Error tracking event:', error);
		}
	};

	const trackPageView = (
		pageName: string,
		properties?: BaseEventProperties,
	) => {
		trackEvent('Page Viewed', {
			page_name: pageName,
			...properties,
		});

		// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º page_view –≤ GA4
		if ($gtag) {
			$gtag('event', 'page_view', {
				page_title: document.title,
				page_location: window.location.href,
				page_path: route.path,
			});
		}
	};

	const identifyUser = (userId: string, properties?: UserProperties) => {
		if (!isEnabled.value) return;

		try {
			// Mixpanel identification
			if ($mixpanel) {
				$mixpanel.identify(userId);
				if (properties) {
					$mixpanel.people.set(properties);
				}
			}

			// GA4 user identification
			if ($gtag) {
				$gtag('set', 'user_properties', {
					user_id: userId,
					...properties,
				});
			}

			if (config.public.analyticsDebug) {
				console.log('[Analytics] User identified:', userId, properties);
			}
		} catch (error) {
			console.error('[Analytics] Error identifying user:', error);
		}
	};

	const setUserProperty = (key: string, value: any) => {
		if (!isEnabled.value) return;

		try {
			if ($mixpanel) {
				$mixpanel.people.set({ [key]: value });
			}

			if ($gtag) {
				$gtag('set', 'user_properties', { [key]: value });
			}
		} catch (error) {
			console.error('[Analytics] Error setting user property:', error);
		}
	};

	const incrementUserProperty = (key: string, by: number = 1) => {
		if (!isEnabled.value) return;

		try {
			if ($mixpanel) {
				$mixpanel.people.increment(key, by);
			}
			// GA4 doesn't support increments directly
		} catch (error) {
			console.error('[Analytics] Error incrementing property:', error);
		}
	};

	const reset = () => {
		if (!isEnabled.value) return;

		try {
			if ($mixpanel) {
				$mixpanel.reset();
			}
			// GA4 doesn't have a reset method, we'd need to clear cookies manually if needed
			if (config.public.analyticsDebug) {
				console.log('[Analytics] User session reset');
			}
		} catch (error) {
			console.error('[Analytics] Error resetting:', error);
		}
	};

	const optOut = () => {
		if (!isEnabled.value) return;

		try {
			if ($mixpanel) {
				$mixpanel.opt_out_tracking();
			}
			if ($gtag) {
				// GA4 opt-out —á–µ—Ä–µ–∑ window property
				window[`ga-disable-${config.public.ga4MeasurementId}`] = true;
			}
			if (config.public.analyticsDebug) {
				console.log('[Analytics] User opted out');
			}
		} catch (error) {
			console.error('[Analytics] Error opting out:', error);
		}
	};

	const optIn = () => {
		if (!isEnabled.value) return;

		try {
			if ($mixpanel) {
				$mixpanel.opt_in_tracking();
			}
			if ($gtag) {
				window[`ga-disable-${config.public.ga4MeasurementId}`] = false;
			}
			if (config.public.analyticsDebug) {
				console.log('[Analytics] User opted in');
			}
		} catch (error) {
			console.error('[Analytics] Error opting in:', error);
		}
	};

	return {
		trackEvent,
		trackPageView,
		identifyUser,
		setUserProperty,
		incrementUserProperty,
		reset,
		optOut,
		optIn,
	};
};

// Helper: Convert Mixpanel event name to GA4 format
function mapToGA4EventName(mixpanelEvent: string): string {
	// Recommended GA4 events
	const ga4RecommendedEvents: Record<string, string> = {
		'Search Performed': 'search',
		'Card Clicked': 'select_content',
		'Page Viewed': 'page_view',
	};

	if (ga4RecommendedEvents[mixpanelEvent]) {
		return ga4RecommendedEvents[mixpanelEvent];
	}

	// Custom events: "Clinic Viewed" ‚Üí "view_clinic"
	return mixpanelEvent
		.toLowerCase()
		.replace(/\s+/g, '_')
		.replace('_viewed', '')
		.replace('_clicked', '');
}

// Helper: Map properties to GA4 format
function mapToGA4Properties(props: any): Record<string, any> {
	const ga4Props: Record<string, any> = {};

	for (const [key, value] of Object.entries(props)) {
		// Skip internal properties
		if (['timestamp', 'page_url', 'page_title', 'page_path'].includes(key)) {
			continue;
		}

		// GA4 has 25-character limit for parameter names
		const ga4Key = key.length > 25 ? key.substring(0, 25) : key;
		ga4Props[ga4Key] = value;
	}

	return ga4Props;
}
```

### 8. Cookie Consent (–±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)

**–ó–∞–¥–∞—á–∞ 8.1:** –°–æ–∑–¥–∞—Ç—å `composables/useCookieConsent.ts`

```typescript
export const useCookieConsent = () => {
	const consent = useCookie('analytics_consent', {
		maxAge: 60 * 60 * 24 * 365, // 1 year
	});

	const hasConsent = computed(() => consent.value === 'granted');

	const grantConsent = () => {
		consent.value = 'granted';

		// Reload page to initialize analytics
		if (process.client) {
			window.location.reload();
		}
	};

	const revokeConsent = () => {
		consent.value = 'denied';

		// Opt out from tracking
		const { optOut } = useAnalytics();
		optOut();
	};

	return {
		hasConsent,
		grantConsent,
		revokeConsent,
	};
};
```

**–ó–∞–¥–∞—á–∞ 8.2:** –°–æ–∑–¥–∞—Ç—å `components/analytics/CookieConsentBanner.vue`

```vue
<template>
	<div v-if="!hasConsent && !isDismissed" class="cookie-consent-banner">
		<div class="cookie-consent-content">
			<p>
				–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º cookies –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫—É (Mixpanel, Google Analytics) –¥–ª—è
				—É–ª—É—á—à–µ–Ω–∏—è –≤–∞—à–µ–≥–æ –æ–ø—ã—Ç–∞.
				<NuxtLink to="/privacy">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</NuxtLink>
			</p>
			<div class="cookie-consent-actions">
				<button @click="handleAccept" class="btn-accept">–ü—Ä–∏–Ω—è—Ç—å</button>
				<button @click="handleDecline" class="btn-decline">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
			</div>
		</div>
	</div>
</template>

<script setup lang="ts">
const { hasConsent, grantConsent, revokeConsent } = useCookieConsent();
const isDismissed = ref(false);

const handleAccept = () => {
	grantConsent();
	isDismissed.value = true;
};

const handleDecline = () => {
	revokeConsent();
	isDismissed.value = true;
};
</script>

<style scoped>
.cookie-consent-banner {
	position: fixed;
	bottom: 0;
	left: 0;
	right: 0;
	background: var(--color-background-elevated);
	border-top: 1px solid var(--color-border);
	padding: var(--spacing-4);
	z-index: 1000;
	box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
}

.cookie-consent-content {
	max-width: 1200px;
	margin: 0 auto;
	display: flex;
	align-items: center;
	justify-content: space-between;
	gap: var(--spacing-4);
}

.cookie-consent-actions {
	display: flex;
	gap: var(--spacing-2);
}

.btn-accept,
.btn-decline {
	padding: var(--spacing-2) var(--spacing-4);
	border-radius: var(--radius-md);
	border: none;
	cursor: pointer;
	font-weight: 500;
}

.btn-accept {
	background: var(--color-primary);
	color: white;
}

.btn-decline {
	background: var(--color-background);
	border: 1px solid var(--color-border);
}

@media (max-width: 768px) {
	.cookie-consent-content {
		flex-direction: column;
		text-align: center;
	}
}
</style>
```

### 9. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ó–∞–¥–∞—á–∞ 9.1:** –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–π —Ç–µ—Å—Ç –¥–ª—è composable

```typescript
// tests/composables/useAnalytics.test.ts
import { describe, it, expect, vi, beforeEach } from 'vitest';
import { useAnalytics } from '~/composables/useAnalytics';

describe('useAnalytics', () => {
	beforeEach(() => {
		// Mock Nuxt app
		vi.mock('#app', () => ({
			useNuxtApp: () => ({
				$mixpanel: {
					track: vi.fn(),
					identify: vi.fn(),
					people: {
						set: vi.fn(),
						increment: vi.fn(),
					},
				},
				$gtag: vi.fn(),
			}),
			useRuntimeConfig: () => ({
				public: {
					analyticsEnabled: true,
					analyticsDebug: false,
					ga4MeasurementId: 'G-TEST',
				},
			}),
			useRoute: () => ({
				path: '/test',
				name: 'test',
			}),
		}));
	});

	it('should track event with properties', () => {
		const { trackEvent } = useAnalytics();
		trackEvent('Test Event', { foo: 'bar' });
		// Assert mocks were called
	});

	it('should send events to both Mixpanel and GA4', () => {
		const { trackEvent } = useAnalytics();
		const { $mixpanel, $gtag } = useNuxtApp();

		trackEvent('Test Event', { test: true });

		expect($mixpanel.track).toHaveBeenCalled();
		expect($gtag).toHaveBeenCalled();
	});

	// More tests...
});
```

### 10. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–ó–∞–¥–∞—á–∞ 10.1:** –°–æ–∑–¥–∞—Ç—å `docs/analytics/setup.md`

````markdown
# Analytics Setup Guide (Mixpanel + Google Analytics 4)

## Installation

1. Install dependencies:
   ```bash
   npm install mixpanel-browser
   ```
````

2. Configure environment variables:

   ```bash
   MIXPANEL_TOKEN=your_token_here
   GA4_MEASUREMENT_ID=G-XXXXXXXXXX
   ANALYTICS_ENABLED=true
   ```

3. Plugins –∏ composables —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## Usage

### Track event (–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ –æ–±–∞ —Å–µ—Ä–≤–∏—Å–∞)

```typescript
const { trackEvent } = useAnalytics();
trackEvent('Button Clicked', { button_name: 'Submit' });
```

### Track page view

```typescript
const { trackPageView } = useAnalytics();
trackPageView('Home Page');
```

### Identify user

```typescript
const { identifyUser } = useAnalytics();
identifyUser('user-123', { $name: 'John Doe' });
```

## Testing

Debug mode:

```bash
ANALYTICS_DEBUG=true npm run dev
```

Check console for analytics events from both Mixpanel and GA4.

## Verification

### Mixpanel

- Go to Mixpanel dashboard ‚Üí Live View
- Perform actions on your site
- Events should appear in real-time

### Google Analytics 4

- Go to GA4 dashboard ‚Üí Reports ‚Üí Realtime
- Perform actions on your site
- Events should appear within 1-2 minutes

## More docs

- [Events Documentation](./events.md)
- [GA4 Events Mapping](./ga4-events.md)
- [Best Practices](./best-practices.md)

````

**–ó–∞–¥–∞—á–∞ 10.2:** –°–æ–∑–¥–∞—Ç—å `docs/analytics/ga4-events.md`

```markdown
# Google Analytics 4 Events Mapping

## Event Name Conversion

Mixpanel –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Title Case ("Clinic Viewed"), GA4 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç snake_case ("view_clinic").

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–∞–ø–ø–∏–Ω–≥

| Mixpanel Event | GA4 Event | Type |
|----------------|-----------|------|
| Search Performed | search | Recommended |
| Card Clicked | select_content | Recommended |
| Clinic Viewed | view_clinic | Custom |
| Doctor Viewed | view_doctor | Custom |
| Phone Clicked | click_phone | Custom |

### GA4 Recommended Events

–ì–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ GA4 —Å–æ–±—ã—Ç–∏—è:
- `search` - –ø–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- `select_content` - –∫–ª–∏–∫–∏ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç—ã
- `page_view` - –ø—Ä–æ—Å–º–æ—Ç—Ä—ã —Å—Ç—Ä–∞–Ω–∏—Ü

### Custom Events

–î–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ–º custom events —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏:
- `view_*` - –ø—Ä–æ—Å–º–æ—Ç—Ä—ã (view_clinic, view_doctor)
- `click_*` - –∫–ª–∏–∫–∏ (click_phone, click_email)
- `copy_*` - –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ (copy_phone, copy_address)

## Property Mapping

GA4 –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- –ú–∞–∫—Å–∏–º—É–º 25 —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è –∏–º–µ–Ω–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
- –ú–∞–∫—Å–∏–º—É–º 100 —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è –∑–Ω–∞—á–µ–Ω–∏—è

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–µ–∑–∞–µ–º –¥–ª–∏–Ω–Ω—ã–µ –∏–º–µ–Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.
````

---

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏

- [ ] Mixpanel SDK —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
- [ ] GA4 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ gtag.js
- [ ] Plugins –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ client-side
- [ ] Composable `useAnalytics()` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –°–æ–±—ã—Ç–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ –æ–±–∞ —Å–µ—Ä–≤–∏—Å–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- [ ] TypeScript —Ç–∏–ø—ã —Å–æ–∑–¥–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] Environment variables –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] Cookie consent banner –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
- [ ] Debug mode —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ development
- [ ] Errors –Ω–µ –ª–æ–º–∞—é—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (graceful degradation)
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏
- [ ] –°–æ–±—ã—Ç–∏—è –≤–∏–¥–Ω—ã –≤ Mixpanel Live View
- [ ] –°–æ–±—ã—Ç–∏—è –≤–∏–¥–Ω—ã –≤ GA4 Realtime
- [ ] –ë–∞–∑–æ–≤–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞

---

## Testing Checklist

### Manual Testing

- [ ] SDK –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] Cookie consent banner –ø–æ—è–≤–ª—è–µ—Ç—Å—è –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] –ü–æ—Å–ª–µ —Å–æ–≥–ª–∞—Å–∏—è, —Å–æ–±—ã—Ç–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ –æ–±–∞ —Å–µ—Ä–≤–∏—Å–∞
- [ ] Debug logs –≤–∏–¥–Ω—ã –≤ development mode
- [ ] –ü—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–Ω–æ–º consent, —Å–æ–±—ã—Ç–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
- [ ] –ú–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å `trackEvent()` –∏–∑ –ª—é–±–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ Mixpanel Dashboard

- [ ] –°–æ–±—ã—Ç–∏—è –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ Mixpanel Live View
- [ ] Super properties –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç
- [ ] User identification —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ GA4 Dashboard

- [ ] –°–æ–±—ã—Ç–∏—è –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ GA4 Realtime
- [ ] Event names –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã (snake_case)
- [ ] User properties —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è

---

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

_–ü–æ–∫–∞ –Ω–µ—Ç_

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —ç—Ç–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏:

1. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ **–ò—Ç–µ—Ä–∞—Ü–∏–∏ 2** - —Å–æ–±—ã—Ç–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü
2. –ù–∞—á–∏–Ω–∞–µ–º –¥–æ–±–∞–≤–ª—è—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
