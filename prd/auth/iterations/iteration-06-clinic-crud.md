# Итерация 6: Создание и редактирование клиник

[← К списку итераций](README.md) | [← Предыдущая](iteration-05-user-profile.md) | [Следующая →](iteration-07-oauth-verification.md)

---

## Цель

Пользователи могут создавать клиники и редактировать их. Созданные клиники имеют статус "draft".

## Зависимости

Итерация 5 (профиль и авторизация работают)

## Задачи

1. Создать API endpoints для CRUD клиник
2. Создать страницу создания клиники
3. Создать страницу редактирования клиники
4. Реализовать проверку прав доступа
5. Создать компонент формы клиники

## Ключевые API Endpoints

### POST /api/clinics

Создание клиники со статусом 'draft', автоматическое добавление создателя как админа

### PUT /api/clinics/[id]

Обновление клиники (только для пользователей с доступом)

### GET /api/clinics/[id]/access

Проверка прав доступа текущего пользователя к клинике

### POST /api/clinics/[id]/request-verification

Отправка клиники на верификацию (меняет status на 'pending_verification')

## Ключевые компоненты

- `pages/clinics/new.vue` - Форма создания клиники
- `pages/clinics/[id]/edit.vue` - Редактирование с отображением статуса
- `components/clinic/ClinicForm.vue` - Переиспользуемая форма клиники

## Критерии приемки

- [ ] AC-1: Авторизованный пользователь может создать клинику через /clinics/new
- [ ] AC-2: Созданная клиника имеет status='draft' и created_by=user_id
- [ ] AC-3: Создатель автоматически добавляется в clinic_users с role='admin'
- [ ] AC-4: Админ клиники может редактировать все поля клиники
- [ ] AC-5: Страница редактирования показывает текущий статус клиники
- [ ] AC-6: Кнопка "Отправить на верификацию" меняет статус на 'pending_verification'
- [ ] AC-7: После отправки на верификацию кнопка исчезает, показывается alert
- [ ] AC-8: Пользователи без прав доступа не могут открыть страницу редактирования
- [ ] AC-9: Все изменения логируются в audit_logs

## Как проверить

1. Войти в систему
2. Перейти на /clinics/new
3. Заполнить форму клиники, создать
4. Проверить в БД:
   ```sql
   SELECT * FROM clinics WHERE created_by = <user_id>;
   SELECT * FROM clinic_users WHERE clinic_id = <clinic_id>;
   SELECT * FROM audit_logs WHERE entity_type = 'clinic';
   ```
5. Перейти на страницу редактирования
6. Изменить данные, сохранить
7. Нажать "Отправить на верификацию"
8. Проверить что status изменился на 'pending_verification'
9. Выйти, войти другим пользователем, попытаться открыть /clinics/<id>/edit - должен редирект

## Статус

**Not Started**

---

**Следующая итерация:** [7. Верификация через OAuth →](iteration-07-oauth-verification.md)
