# 1. Обзор: Самостоятельная покупка платных услуг для клиник

[← Назад к оглавлению](index.md)

---

## 1.1 Цель

Предоставить администраторам клиник возможность самостоятельно покупать платные услуги (DOFOLLOW, HIGHLIGHT, APPROVED) через интерфейс профиля клиники с онлайн-оплатой, аналогично процессу покупки через админку.

**Ключевая ценность:**

- Администраторы клиник могут самостоятельно управлять платными услугами без обращения к суперадмину
- Увеличение конверсии за счет упрощения процесса покупки
- Автоматизация активации услуг после оплаты
- Прозрачность истории покупок и активных услуг

---

## 1.2 Контекст

### Текущая ситуация

На данный момент в системе существует:

1. **Таблица `billing_paid_services`** с услугами:

   - DOFOLLOW (id: 1) - dofollow ссылки
   - HIGHLIGHT (id: 2) - выделение в списках
   - APPROVED (id: 3) - верификация клиники

2. **Таблицы покупок:**

   - `billing_clinic_service_purchases` - покупки клиник
   - `billing_clinic_service_purchase_items` - элементы покупок

3. **Админка** (`components/admin/clinic-find.vue`):

   - Суперадмин может добавлять покупки вручную через форму
   - Указывается: услуги, цена, дата покупки, дата окончания
   - Покупки отображаются в таблице с возможностью удаления/восстановления

4. **API endpoints** для админки:
   - `POST /api/billing/services/list` - список услуг
   - `POST /api/billing/clinic-purchases/list` - покупки клиники
   - `POST /api/billing/clinic-purchases/add` - добавить покупку (админ)
   - `POST /api/billing/clinic-purchases/delete` - удалить покупку (админ)
   - `POST /api/billing/clinic-purchases/restore` - восстановить покупку (админ)

### Проблема

Текущая система работает только через суперадмина:

- Клиники не могут самостоятельно покупать услуги
- Длительный процесс: клиника → запрос → оплата → суперадмин активирует
- Нет автоматизации оплаты и активации
- Низкая конверсия из-за сложности процесса

### Решение

Создать self-service интерфейс для администраторов клиник:

- Просмотр каталога услуг с описаниями и ценами
- Выбор услуг и периода действия
- Онлайн-оплата через платежную систему
- Автоматическая активация после оплаты
- История покупок с фильтрами

---

## 1.3 Целевые пользователи

### Основной пользователь: Администратор клиники

**Профиль:**

- Владелец или менеджер клиники
- Имеет роль `clinic_admin` в системе
- Управляет профилем клиники
- Хочет улучшить видимость клиники в системе

**Потребности:**

- Быстро и самостоятельно купить услуги
- Видеть, какие услуги активны и когда истекают
- Получать подтверждение оплаты
- Видеть результат активации на публичной странице

**User Stories:**

1. Как администратор клиники, я хочу видеть кнопку "Платные услуги" в профиле клиники, чтобы легко найти эту функцию
2. Как администратор клиники, я хочу видеть каталог всех доступных услуг с описаниями и ценами
3. Как администратор клиники, я хочу выбрать несколько услуг одновременно и купить их одним платежом
4. Как администратор клиники, я хочу выбрать период действия услуг (1, 3, 6, 12 месяцев)
5. Как администратор клиники, я хочу оплатить услуги онлайн через безопасную платежную систему
6. Как администратор клиники, я хочу видеть историю всех моих покупок
7. Как администратор клиники, я хочу получить email подтверждение после оплаты
8. Как администратор клиники, я хочу сразу видеть активированные услуги на публичной странице клиники

---

## 1.4 Предположения

1. **Авторизация реализована**

   - Существует система авторизации пользователей
   - Реализована роль `clinic_admin`

2. **Профиль клиники работает**

   - Администратор имеет доступ к `/profile/clinics/[id]`
   - Существует связь user → clinic

3. **Платежная система**

   - Будет выбрана надежная платежная система (Stripe, PayPal или локальная)
   - Платежная система поддерживает webhooks для подтверждения оплаты
   - Транзакции проходят в EUR или USD

4. **Email система**

   - В системе есть возможность отправки email
   - Email шаблоны можно создавать

5. **База данных**
   - Таблицы `billing_*` уже существуют и работают
   - Можно добавлять новые таблицы при необходимости

---

## 1.5 Ограничения

### Технические ограничения

1. **Платежная система**

   - Ограничения платежной системы на минимальную сумму платежа
   - Комиссии платежной системы
   - Время обработки платежа (может быть до 5 минут)

2. **База данных**

   - Используем существующую структуру `billing_clinic_service_purchases`
   - Нельзя изменять логику существующих API endpoints для админки

3. **Безопасность**
   - Только администраторы клиники могут покупать услуги для своей клиники
   - Нельзя покупать для других клиник
   - Все транзакции логируются

### Бизнес ограничения

1. **Ценообразование**

   - Цены на услуги определяются суперадмином (не в scope этого PRD)
   - Цены могут отличаться в зависимости от периода

2. **Возврат платежей**

   - Возврат платежей НЕ включен в первую версию
   - Будет реализован в будущих версиях

3. **Промокоды и скидки**
   - НЕ включены в первую версию
   - Будут реализованы в будущих версиях

### Scope ограничения

**Что включено:**

- Просмотр каталога услуг
- Выбор услуг и периода
- Создание заказа
- Онлайн-оплата
- Автоматическая активация
- История покупок

**Что НЕ включено:**

- Подписки с автопродлением
- Промокоды и скидки
- Возврат платежей
- Оплата счетов (invoice payments)
- Пробные периоды (trial)
- Корпоративные скидки

---

## 1.6 Success Metrics (Метрики успеха)

### Бизнес метрики

1. **Конверсия**

   - % клиник, посетивших страницу платных услуг и совершивших покупку
   - **Цель:** > 10% конверсия

2. **Средний чек**

   - Средняя сумма заказа
   - **Цель:** отслеживание роста

3. **Активные покупки**
   - Количество клиник с активными платными услугами
   - **Цель:** рост на 50% за 3 месяца

### Технические метрики

1. **Время оплаты**

   - Среднее время от создания заказа до подтверждения оплаты
   - **Цель:** < 5 минут для 95% транзакций

2. **Успешность платежей**

   - % успешных платежей от всех попыток
   - **Цель:** > 95%

3. **Время активации**
   - Среднее время от подтверждения оплаты до активации услуг
   - **Цель:** < 30 секунд

### UX метрики

1. **Отказы**

   - % пользователей, начавших заказ и не завершивших его
   - **Цель:** < 40%

2. **Повторные покупки**
   - % клиник, совершивших повторную покупку
   - **Цель:** > 30% за 6 месяцев

---

**Следующая секция:** [2. Требования →](02-requirements.md)
