# 1. Обзор: Каталог клиник

[← Назад к оглавлению](index.md)

---

## Цель

Создать удобный каталог клиник с умным поиском, автоматическим определением города пользователя и сортировкой по расстоянию, чтобы пользователи могли быстро найти ближайшие к ним клиники.

---

## Контекст

### Текущая ситуация

На платформе уже реализован базовый список клиник с фильтрацией:

- ✅ Фильтрация по городу
- ✅ Фильтрация по языкам обслуживания
- ✅ Поиск по названию
- ✅ Пагинация

### Проблема

Пользователи не видят **ближайшие к ним клиники** в первую очередь. Им приходится:

- Вручную выбирать свой город в фильтрах
- Прокручивать список в поисках ближайшей клиники
- Не видят расстояние до клиники

Это создает негативный UX и снижает конверсию.

---

## Решение

### Умная геолокация (Итерация 2)

**Автоматически определять город пользователя по IP-адресу** (без запроса разрешения браузера) и **сортировать список клиник по расстоянию** от пользователя.

**Ключевые принципы:**

1. **Автоматизм** - город определяется при первом заходе, пользователь ничего не делает
2. **Прозрачность** - пользователь видит свой город в UI и может его изменить
3. **Не фильтр** - геолокация влияет только на СОРТИРОВКУ, все клиники остаются видимыми
4. **Персистентность** - выбранный город сохраняется (localStorage + БД)

### Расширенные фильтры (Итерация 3)

Добавить удобные фильтры для специфических запросов:

- Фильтр по специализации
- Фильтр по услугам
- Фильтр по рейтингу
- Фильтр "Работает сейчас" (на основе графика работы)

### Карта клиник (Итерация 4)

Визуализировать клиники на Google Maps с интерактивностью:

- Показать все клиники на карте
- Кластеризация маркеров
- Синхронизация списка и карты

---

## Ценность для пользователей

### Для пациентов

✅ **Видят ближайшие клиники первыми** - экономия времени на поиск  
✅ **Видят расстояние до клиники** - могут оценить доступность  
✅ **Не нужно вводить город вручную** - автоматическое определение  
✅ **Могут изменить город** - гибкость для путешественников  
✅ **Видят все клиники** - геолокация не скрывает результаты

### Для клиник

✅ **Больше трафика от местных пользователей** - ближайшие клиники на первых позициях  
✅ **Честная конкуренция** - сортировка по расстоянию объективна  
✅ **Прозрачность** - пользователи видят точное расстояние

### Для платформы

✅ **Увеличение конверсии** - пользователи быстрее находят клиники  
✅ **Улучшение UX** - персонализированный список  
✅ **Снижение bounce rate** - релевантные результаты с первого экрана

---

## Предположения

### Технические

1. У всех клиник заполнены координаты (latitude, longitude)
2. IP Geolocation API доступен и стабилен
3. Список городов в БД соответствует городам, которые возвращает IP API
4. Расчет расстояния (Haversine) не создаст проблем с производительностью

### Бизнес

1. Пользователи хотят видеть ближайшие клиники первыми
2. Геолокация по IP достаточно точна для городского уровня
3. Пользователи не будут возражать против определения города по IP (анонимно)
4. Путешественники/туристы будут вручную менять город

### UX

1. Пользователи поймут, что город можно изменить
2. Отображение расстояния (км/м) будет полезным
3. Геолокация не должна работать как фильтр (все клиники видны)

---

## Out of Scope (для будущих версий)

❌ Точная геолокация по GPS браузера (требует разрешения)  
❌ Автоматический выбор ближайшей клиники (пользователь сам выбирает)  
❌ Маршруты до клиники (транспорт, время в пути)  
❌ Рекомендации на основе истории просмотров  
❌ Избранные клиники (wishlist)  
❌ Сравнение клиник (side-by-side)

---

## Метрики успеха

### Adoption

- ✅ **> 95% пользователей** имеют определенный город (IP геолокация работает)
- ✅ **< 10% пользователей** меняют город вручную (точность определения)

### Engagement

- ✅ **+20% CTR** на клиники в топ-3 позиций (после сортировки по расстоянию)
- ✅ **+15% конверсия** в просмотр карточки клиники
- ✅ **-20% bounce rate** на странице списка клиник

### Performance

- ✅ **< 300ms** определение города по IP
- ✅ **< 500ms** сортировка списка по расстоянию
- ✅ **< 1 секунда** полная загрузка страницы

### Quality

- ✅ **> 90% точность** определения города по IP
- ✅ **< 5% ошибок** геолокации (используется fallback)

---

## Ограничения

### Технические

- Бесплатные IP Geolocation API имеют лимиты (например, 1000 req/день)
- IP геолокация может быть неточной для VPN/Proxy пользователей
- Расчет расстояния приблизительный (не учитывает дороги)

### Юридические

- Нужно соблюдать GDPR (IP-адреса = персональные данные)
- Не сохраняем IP-адреса в БД
- Пользователь может отказаться от геолокации (выбрать "Не определено")

### UX

- Геолокация по IP менее точная, чем GPS браузера
- Для туристов/путешественников нужна возможность смены города

---

## Зависимости

### Внутренние

- ✅ **Базовый список клиник** (уже реализовано)
- ✅ **Таблица `cities`** - список городов с координатами
- ✅ **Координаты клиник** - latitude, longitude для всех клиник
- ⚠️ **Авторизация** - для сохранения города в БД (опционально)

### Внешние

- ⚠️ **IP Geolocation API** - для определения города по IP (например, ipapi.co)
- ✅ **Google Maps API** - для карты клиник (уже используется)

---

## Риски

### Высокие

1. **Лимиты IP Geolocation API**
   - **Митигация:** Кэширование на 30 дней, fallback на Podgorica
2. **Неточность геолокации**
   - **Митигация:** Возможность вручную изменить город

### Средние

3. **Производительность сортировки**
   - **Митигация:** Индексы в БД, кэширование, расчет на клиенте

---

[← Назад к оглавлению](index.md) | [Следующий раздел: Требования →](02-requirements.md)
