# 2. Требования: Каталог клиник

[← Назад к оглавлению](index.md)

---

## Функциональные требования

### Базовые (реализовано)

**FR-1.1** Отображать список всех клиник с пагинацией  
**FR-1.2** Фильтровать клиники по городу  
**FR-1.3** Фильтровать клиники по языкам обслуживания  
**FR-1.4** Искать клиники по названию  
**FR-1.5** Отображать карточку клиники с основной информацией

### Геолокация и сортировка по расстоянию (Итерация 2) - **ПРИОРИТЕТ**

**FR-2.1** Автоматически определять город пользователя по IP-адресу

- Использовать IP Geolocation API
- Не требовать разрешение браузера на геолокацию
- Определять при первом заходе на сайт
- Кэшировать результат в localStorage на 30 дней

**FR-2.2** Сортировать список клиник по расстоянию от города пользователя

- Ближайшие клиники показывать первыми
- Расстояние рассчитывать от центра города до координат клиники
- Использовать формулу Haversine для точного расчета расстояния

**FR-2.3** Отображать расстояние до клиники

- Показывать в километрах (до 100 км)
- Показывать в метрах (до 1 км)
- Локализовать единицы измерения
- Пример: "1.2 км", "500 м", "45 км"

**FR-2.4** Отображать текущий город пользователя в интерфейсе

- Показывать город в выпадающем меню профиля (если пользователь авторизован)
- Показывать город рядом с поиском/фильтрами (если пользователь не авторизован)
- Визуально выделить, что город можно изменить (иконка маркера + dropdown)

**FR-2.5** Позволять пользователю вручную изменить свой город

- Dropdown с полным списком городов
- Поиск по названию города в dropdown
- Автоматическое применение нового города (пересортировка списка)
- Сохранение выбора в localStorage (для не авторизованных)
- Сохранение выбора в БД (для авторизованных пользователей)

**FR-2.6** Геолокация НЕ должна работать как фильтр

- Пользователь всегда видит ВСЕ клиники (независимо от города)
- Город влияет только на СОРТИРОВКУ списка
- Фильтр по городу остается отдельной опцией
- При включенном фильтре по городу, геолокация не влияет на сортировку

**FR-2.7** Отображать индикатор "Ваш город"

- Для клиник в городе пользователя показывать бейдж "Ваш город"
- Визуально выделять ближайшие клиники (например, зеленой рамкой)

### Расширенные фильтры (Итерация 3)

**FR-3.1** Фильтровать клиники по специализации  
**FR-3.2** Фильтровать клиники по услугам  
**FR-3.3** Фильтровать клиники по рейтингу (от X звезд)  
**FR-3.4** Фильтр "Работает сейчас" (на основе графика работы)  
**FR-3.5** Фильтр "Только верифицированные клиники"

### Карта (Итерация 4)

**FR-4.1** Отображать клиники на Google Maps  
**FR-4.2** Кластеризация маркеров при зуме out  
**FR-4.3** Показывать popup с информацией при клике на маркер  
**FR-4.4** Синхронизировать список и карту (выбор в списке = выделение на карте)  
**FR-4.5** Переключение между режимами "Список" и "Карта"

---

## Нефункциональные требования

### Производительность

**NFR-1** API геолокации должен отвечать менее чем за 300ms  
**NFR-2** Сортировка по расстоянию не должна замедлять загрузку списка  
**NFR-3** Список клиник должен загружаться менее чем за 1 секунду  
**NFR-4** При изменении города, пересортировка должна происходить мгновенно (< 100ms на клиенте)

### Локализация

**NFR-5** Все тексты должны быть локализованы на 6 языков  
**NFR-6** Названия городов должны локализоваться  
**NFR-7** Единицы измерения расстояния должны локализоваться

### UX

**NFR-8** Пользователь должен видеть прогресс при определении города  
**NFR-9** При ошибке геолокации, показывать fallback (столица - Podgorica)  
**NFR-10** Изменение города не должно сбрасывать другие фильтры  
**NFR-11** Dropdown выбора города должен быть удобным на мобильных устройствах

### Безопасность и приватность

**NFR-12** IP-адрес пользователя не должен сохраняться в БД  
**NFR-13** Определение города по IP должно быть анонимным (без персональных данных)  
**NFR-14** Пользователь должен иметь возможность отключить геолокацию (выбрать "Не определено")

### SEO

**NFR-15** URL должен отражать выбранные фильтры (включая город)  
**NFR-16** Заголовок страницы должен включать текущие фильтры  
**NFR-17** Canonical URL для страниц с одинаковым контентом

---

## Out of Scope (для будущих версий)

❌ Точная геолокация по GPS браузера (только IP)  
❌ Сохранение истории просмотров клиник  
❌ Рекомендации клиник на основе AI  
❌ Сравнение клиник (side-by-side)  
❌ Избранные клиники (wishlist)  
❌ Расширенная карта (маршруты, транспорт)

---

## Критерии приемки

### Для Итерации 2 (Геолокация)

- [ ] AC-2.1: При первом заходе на сайт, город определяется по IP
- [ ] AC-2.2: Список клиник автоматически сортируется по расстоянию от города пользователя
- [ ] AC-2.3: Каждая карточка клиники показывает расстояние (км/м)
- [ ] AC-2.4: Текущий город отображается в UI (в профиле или рядом с фильтрами)
- [ ] AC-2.5: Пользователь может изменить город через dropdown
- [ ] AC-2.6: При изменении города, список пересортировывается
- [ ] AC-2.7: Выбранный город сохраняется в localStorage
- [ ] AC-2.8: Для авторизованных пользователей город сохраняется в БД
- [ ] AC-2.9: Геолокация НЕ скрывает клиники из других городов
- [ ] AC-2.10: При ошибке геолокации, используется fallback (Podgorica)
- [ ] AC-2.11: Локализация работает на всех 6 языках

### Для Итерации 3 (Расширенные фильтры)

- [ ] AC-3.1: Фильтр по специализации работает корректно
- [ ] AC-3.2: Фильтр "Работает сейчас" учитывает график работы
- [ ] AC-3.3: Можно комбинировать несколько фильтров одновременно
- [ ] AC-3.4: URL обновляется при изменении фильтров

### Для Итерации 4 (Карта)

- [ ] AC-4.1: Клиники отображаются на Google Maps
- [ ] AC-4.2: Кластеризация работает при zoom out
- [ ] AC-4.3: Клик на маркер открывает popup с информацией
- [ ] AC-4.4: Переключение список/карта работает без перезагрузки

---

## Приоритеты

1. **P0 (критично):** FR-2.1 - FR-2.7 (Геолокация и сортировка)
2. **P1 (высокий):** FR-3.1 - FR-3.5 (Расширенные фильтры)
3. **P2 (средний):** FR-4.1 - FR-4.5 (Карта)

---

[← Назад к оглавлению](index.md)
