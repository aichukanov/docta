# –ò—Ç–µ—Ä–∞—Ü–∏—è 2: –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∫–ª–∏–Ω–∏–∫ –ø–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é

[‚Üê –ö —Å–ø–∏—Å–∫—É –∏—Ç–µ—Ä–∞—Ü–∏–π](README.md) | [‚Üê –ö –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é PRD](../index.md)

---

## –¶–µ–ª—å

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —É–º–Ω—É—é –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ IP-–∞–¥—Ä–µ—Å—É –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É —Å–ø–∏—Å–∫–∞ –∫–ª–∏–Ω–∏–∫ –ø–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –≤–∏–¥–µ—Ç—å –±–ª–∏–∂–∞–π—à–∏–µ –∫ –Ω–µ–º—É –∫–ª–∏–Ω–∏–∫–∏ –ø–µ—Ä–≤—ã–º–∏, —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –≤—Ä—É—á–Ω—É—é –∏–∑–º–µ–Ω–∏—Ç—å —Å–≤–æ–π –≥–æ—Ä–æ–¥.

**–í–∞–∂–Ω–æ:** –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —É–º–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞, –ù–ï –∫–∞–∫ —Ñ–∏–ª—å—Ç—Ä. –í—Å–µ –∫–ª–∏–Ω–∏–∫–∏ –æ—Å—Ç–∞—é—Ç—Å—è –≤–∏–¥–∏–º—ã–º–∏.

---

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–¢—Ä–µ–±—É–µ—Ç—Å—è:**

- ‚úÖ –ë–∞–∑–æ–≤—ã–π —Å–ø–∏—Å–æ–∫ –∫–ª–∏–Ω–∏–∫ (–ò—Ç–µ—Ä–∞—Ü–∏—è 1)
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `cities` –≤ –ë–î
- ‚úÖ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (latitude, longitude) –¥–ª—è –≤—Å–µ—Ö –∫–ª–∏–Ω–∏–∫

**–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:**

- ‚ö†Ô∏è –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≥–æ—Ä–æ–¥–∞ –≤ –ë–î)

---

## –ó–∞–¥–∞—á–∏

### –ó–∞–¥–∞—á–∞ 1: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å IP Geolocation API

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**

1. –í—ã–±—Ä–∞—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ IP Geolocation:

   - **ipapi.co** (–±–µ—Å–ø–ª–∞—Ç–Ω–æ 1000 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å, HTTPS, JSON)
   - **ipgeolocation.io** (–±–µ—Å–ø–ª–∞—Ç–Ω–æ 1000 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å, –º–Ω–æ–≥–æ –¥–∞–Ω–Ω—ã—Ö)
   - **ip-api.com** (–±–µ—Å–ø–ª–∞—Ç–Ω–æ 45 req/min, –±–µ–∑ HTTPS –Ω–∞ free tier)

   **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ipapi.co` –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ (HTTPS) –∏ `ip-api.com` –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

2. –°–æ–∑–¥–∞—Ç—å API endpoint –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≥–æ—Ä–æ–¥–∞ –ø–æ IP

**–§–∞–π–ª:** `server/api/geo/detect-location.get.ts`

```typescript
import type { H3Event } from 'h3';

interface IpApiResponse {
	city?: string;
	country_code?: string;
	latitude?: number;
	longitude?: number;
	region?: string;
}

interface DetectedLocation {
	city: string;
	country: string;
	latitude: number;
	longitude: number;
	detected: boolean;
	fallback: boolean;
}

const FALLBACK_LOCATION: DetectedLocation = {
	city: 'Podgorica',
	country: 'ME',
	latitude: 42.4304,
	longitude: 19.2594,
	detected: false,
	fallback: true,
};

export default defineEventHandler(
	async (event: H3Event): Promise<DetectedLocation> => {
		try {
			// –ü–æ–ª—É—á–∞–µ–º IP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
			const clientIp = getRequestIP(event, { xForwardedFor: true });

			// –õ–æ–∫–∞–ª—å–Ω—ã–µ IP - –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback
			if (
				!clientIp ||
				clientIp === '127.0.0.1' ||
				clientIp.startsWith('192.168.') ||
				clientIp.startsWith('10.')
			) {
				console.log('[GEO] Local IP detected, using fallback location');
				return FALLBACK_LOCATION;
			}

			console.log(`[GEO] Detecting location for IP: ${clientIp}`);

			// –í—ã–∑—ã–≤–∞–µ–º IP Geolocation API
			const response = await $fetch<IpApiResponse>(
				`https://ipapi.co/${clientIp}/json/`,
				{
					timeout: 3000, // 3 —Å–µ–∫—É–Ω–¥—ã –º–∞–∫—Å–∏–º—É–º
				},
			);

			// –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞
			if (!response.city || !response.latitude || !response.longitude) {
				console.log('[GEO] Invalid response from IP API, using fallback');
				return FALLBACK_LOCATION;
			}

			// –ò—â–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –≥–æ—Ä–æ–¥ –≤ –Ω–∞—à–µ–π –ë–î
			const db = useDatabase();
			const matchedCity = await db.sql<{ id: number; name: string }[]>`
      SELECT id, name
      FROM cities
      WHERE LOWER(name) = LOWER(${response.city})
         OR LOWER(name_local) = LOWER(${response.city})
      LIMIT 1
    `;

			// –ï—Å–ª–∏ –≥–æ—Ä–æ–¥ –Ω–∞–π–¥–µ–Ω –≤ –ë–î, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
			if (matchedCity.length > 0) {
				return {
					city: matchedCity[0].name,
					country: response.country_code || 'ME',
					latitude: response.latitude,
					longitude: response.longitude,
					detected: true,
					fallback: false,
				};
			}

			// –ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ë–î - –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback
			console.log(
				`[GEO] City "${response.city}" not found in database, using fallback`,
			);
			return FALLBACK_LOCATION;
		} catch (error) {
			console.error('[GEO] Error detecting location:', error);
			return FALLBACK_LOCATION;
		}
	},
);
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**

- [ ] AC-1.1: API endpoint `/api/geo/detect-location` —Å–æ–∑–¥–∞–Ω
- [ ] AC-1.2: –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≥–æ—Ä–æ–¥ –ø–æ IP-–∞–¥—Ä–µ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] AC-1.3: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (latitude, longitude)
- [ ] AC-1.4: –ü—Ä–∏ –æ—à–∏–±–∫–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç fallback (Podgorica)
- [ ] AC-1.5: –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

---

### –ó–∞–¥–∞—á–∞ 2: –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è (Haversine)

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**

–°–æ–∑–¥–∞—Ç—å —É—Ç–∏–ª–∏—Ç—É –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É –¥–≤—É–º—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏.

**–§–∞–π–ª:** `utils/distance.ts`

```typescript
/**
 * –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –¥–≤—É–º—è —Ç–æ—á–∫–∞–º–∏ –ø–æ —Ñ–æ—Ä–º—É–ª–µ Haversine
 * @param lat1 –®–∏—Ä–æ—Ç–∞ –ø–µ—Ä–≤–æ–π —Ç–æ—á–∫–∏
 * @param lon1 –î–æ–ª–≥–æ—Ç–∞ –ø–µ—Ä–≤–æ–π —Ç–æ—á–∫–∏
 * @param lat2 –®–∏—Ä–æ—Ç–∞ –≤—Ç–æ—Ä–æ–π —Ç–æ—á–∫–∏
 * @param lon2 –î–æ–ª–≥–æ—Ç–∞ –≤—Ç–æ—Ä–æ–π —Ç–æ—á–∫–∏
 * @returns –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –≤ –∫–∏–ª–æ–º–µ—Ç—Ä–∞—Ö
 */
export function calculateDistance(
	lat1: number,
	lon1: number,
	lat2: number,
	lon2: number,
): number {
	const R = 6371; // –†–∞–¥–∏—É—Å –ó–µ–º–ª–∏ –≤ –∫–∏–ª–æ–º–µ—Ç—Ä–∞—Ö
	const dLat = toRadians(lat2 - lat1);
	const dLon = toRadians(lon2 - lon1);

	const a =
		Math.sin(dLat / 2) * Math.sin(dLat / 2) +
		Math.cos(toRadians(lat1)) *
			Math.cos(toRadians(lat2)) *
			Math.sin(dLon / 2) *
			Math.sin(dLon / 2);

	const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
	const distance = R * c;

	return Math.round(distance * 10) / 10; // –û–∫—Ä—É–≥–ª—è–µ–º –¥–æ 1 –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
}

function toRadians(degrees: number): number {
	return degrees * (Math.PI / 180);
}

/**
 * –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
 * @param distanceKm –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –≤ –∫–∏–ª–æ–º–µ—Ç—Ä–∞—Ö
 * @param locale –¢–µ–∫—É—â–∞—è –ª–æ–∫–∞–ª—å
 * @returns –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "1.2 –∫–º" –∏–ª–∏ "500 –º")
 */
export function formatDistance(distanceKm: number, locale: string): string {
	if (distanceKm < 1) {
		const meters = Math.round(distanceKm * 1000);
		return locale === 'en' ? `${meters} m` : `${meters} –º`;
	}

	return locale === 'en' ? `${distanceKm} km` : `${distanceKm} –∫–º`;
}
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**

- [ ] AC-2.1: –§—É–Ω–∫—Ü–∏—è `calculateDistance` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ
- [ ] AC-2.2: –§—É–Ω–∫—Ü–∏—è `formatDistance` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –¥–ª—è –≤—Å–µ—Ö –ª–æ–∫–∞–ª–µ–π
- [ ] AC-2.3: –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–Ω–µ–µ 1 –∫–º –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –º–µ—Ç—Ä–∞—Ö
- [ ] AC-2.4: –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ–∫—Ä—É–≥–ª—è–µ—Ç—Å—è –¥–æ 1 –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π

---

### –ó–∞–¥–∞—á–∞ 3: –û–±–Ω–æ–≤–∏—Ç—å API —Å–ø–∏—Å–∫–∞ –∫–ª–∏–Ω–∏–∫ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**

–û–±–Ω–æ–≤–∏—Ç—å `POST /api/clinics/list` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é.

**–§–∞–π–ª:** `server/api/clinics/list.post.ts`

–î–æ–±–∞–≤–∏—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

```typescript
interface ClinicsListRequest {
	// ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
	userLatitude?: number;
	userLongitude?: number;
	sortByDistance?: boolean;
}
```

–û–±–Ω–æ–≤–∏—Ç—å SQL –∑–∞–ø—Ä–æ—Å:

```typescript
// –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –¥–æ–±–∞–≤–ª—è–µ–º —Ä–∞—Å—á–µ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
let distanceSelect = '';
let orderBy = 'c.id DESC';

if (sortByDistance && userLatitude && userLongitude) {
	distanceSelect = `,
    (6371 * acos(
      cos(radians(${userLatitude})) * 
      cos(radians(c.latitude)) * 
      cos(radians(c.longitude) - radians(${userLongitude})) + 
      sin(radians(${userLatitude})) * 
      sin(radians(c.latitude))
    )) AS distance
  `;
	orderBy = 'distance ASC';
}

const clinics = await db.sql`
  SELECT
    c.id,
    c.name,
    c.name_local,
    c.address,
    c.city_id,
    c.latitude,
    c.longitude,
    c.phone,
    c.approved
    ${raw(distanceSelect)}
  FROM clinics c
  WHERE 1=1
  ${cityFilter}
  ${languageFilter}
  ${nameFilter}
  ORDER BY ${raw(orderBy)}
  LIMIT ${pageSize}
  OFFSET ${offset}
`;
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**

- [ ] AC-3.1: API –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `userLatitude`, `userLongitude`, `sortByDistance`
- [ ] AC-3.2: –ü—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç, —Å–ø–∏—Å–æ–∫ —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é
- [ ] AC-3.3: –ö–∞–∂–¥–∞—è –∫–ª–∏–Ω–∏–∫–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–µ `distance` (–≤ –∫–º)
- [ ] AC-3.4: –ë–µ–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ (–ø–æ ID)
- [ ] AC-3.5: API —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–æ (< 500ms)

---

### –ó–∞–¥–∞—á–∞ 4: –°–æ–∑–¥–∞—Ç—å composable –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≥–µ–æ–ª–æ–∫–∞—Ü–∏–µ–π

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**

–°–æ–∑–¥–∞—Ç—å `composable` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ª–æ–∫–∞—Ü–∏–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–§–∞–π–ª:** `composables/useUserLocation.ts`

```typescript
import { ref, computed } from 'vue';

interface UserLocation {
	city: string;
	latitude: number;
	longitude: number;
	detected: boolean;
	fallback: boolean;
}

const userLocation = ref<UserLocation | null>(null);
const isLoadingLocation = ref(false);

export function useUserLocation() {
	const STORAGE_KEY = 'user_location';
	const STORAGE_EXPIRY_DAYS = 30;

	/**
	 * –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ª–æ–∫–∞—Ü–∏—é –∏–∑ localStorage
	 */
	function loadFromStorage(): UserLocation | null {
		if (process.server) return null;

		try {
			const stored = localStorage.getItem(STORAGE_KEY);
			if (!stored) return null;

			const data = JSON.parse(stored);
			const expiryDate = new Date(data.expiry);

			// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
			if (expiryDate < new Date()) {
				localStorage.removeItem(STORAGE_KEY);
				return null;
			}

			return data.location;
		} catch {
			return null;
		}
	}

	/**
	 * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ª–æ–∫–∞—Ü–∏—é –≤ localStorage
	 */
	function saveToStorage(location: UserLocation) {
		if (process.server) return;

		try {
			const expiry = new Date();
			expiry.setDate(expiry.getDate() + STORAGE_EXPIRY_DAYS);

			localStorage.setItem(
				STORAGE_KEY,
				JSON.stringify({
					location,
					expiry: expiry.toISOString(),
				}),
			);
		} catch (error) {
			console.error('Failed to save location to storage:', error);
		}
	}

	/**
	 * –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ª–æ–∫–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ IP
	 */
	async function detectLocation() {
		// –ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage
		const cached = loadFromStorage();
		if (cached) {
			userLocation.value = cached;
			return cached;
		}

		// –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ IP
		isLoadingLocation.value = true;
		try {
			const detected = await $fetch<UserLocation>('/api/geo/detect-location');
			userLocation.value = detected;
			saveToStorage(detected);
			return detected;
		} catch (error) {
			console.error('Failed to detect location:', error);
			return null;
		} finally {
			isLoadingLocation.value = false;
		}
	}

	/**
	 * –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ª–æ–∫–∞—Ü–∏—é –≤—Ä—É—á–Ω—É—é (–∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –≥–æ—Ä–æ–¥)
	 */
	function setLocation(city: string, latitude: number, longitude: number) {
		const location: UserLocation = {
			city,
			latitude,
			longitude,
			detected: false,
			fallback: false,
		};
		userLocation.value = location;
		saveToStorage(location);

		// TODO: –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î
	}

	/**
	 * –û—á–∏—â–∞–µ—Ç –ª–æ–∫–∞—Ü–∏—é
	 */
	function clearLocation() {
		userLocation.value = null;
		if (process.client) {
			localStorage.removeItem(STORAGE_KEY);
		}
	}

	return {
		userLocation: computed(() => userLocation.value),
		isLoadingLocation: computed(() => isLoadingLocation.value),
		detectLocation,
		setLocation,
		clearLocation,
	};
}
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**

- [ ] AC-4.1: `useUserLocation` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â—É—é –ª–æ–∫–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] AC-4.2: `detectLocation()` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≥–æ—Ä–æ–¥ –ø–æ IP
- [ ] AC-4.3: –õ–æ–∫–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage –Ω–∞ 30 –¥–Ω–µ–π
- [ ] AC-4.4: `setLocation()` –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—Ä—É—á–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≥–æ—Ä–æ–¥
- [ ] AC-4.5: –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∑–∞—Ö–æ–¥–µ, –ª–æ–∫–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ localStorage

---

### –ó–∞–¥–∞—á–∞ 5: –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç LocationSelector

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**

–°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≥–æ—Ä–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–§–∞–π–ª:** `components/LocationSelector.vue`

```vue
<script setup lang="ts">
import { ref, computed } from 'vue';
import { useI18n } from 'vue-i18n';
import { useUserLocation } from '~/composables/useUserLocation';

const { t, locale } = useI18n();
const { userLocation, setLocation } = useUserLocation();

// –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≥–æ—Ä–æ–¥–æ–≤
const { data: cities } = await useFetch('/api/cities/list');

const isDropdownOpen = ref(false);
const searchQuery = ref('');

const filteredCities = computed(() => {
	if (!cities.value || !searchQuery.value) return cities.value;

	const query = searchQuery.value.toLowerCase();
	return cities.value.filter(
		(city: any) =>
			city.name.toLowerCase().includes(query) ||
			city.name_local.toLowerCase().includes(query),
	);
});

function selectCity(city: any) {
	setLocation(city.name, city.latitude, city.longitude);
	isDropdownOpen.value = false;
	searchQuery.value = '';

	// –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
	window.location.reload();
}

const displayCity = computed(() => {
	if (!userLocation.value) return t('SelectCity');

	return userLocation.value.city;
});
</script>

<template>
	<div class="location-selector">
		<button
			class="location-selector__button"
			@click="isDropdownOpen = !isDropdownOpen"
			:aria-expanded="isDropdownOpen"
			:aria-label="t('ChangeLocation')"
		>
			<svg
				class="location-icon"
				width="16"
				height="16"
				viewBox="0 0 16 16"
				fill="currentColor"
			>
				<path
					d="M8 0C5.2 0 3 2.2 3 5c0 3.5 5 11 5 11s5-7.5 5-11c0-2.8-2.2-5-5-5zm0 7c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"
				/>
			</svg>
			<span class="location-selector__city">{{ displayCity }}</span>
			<svg
				class="dropdown-arrow"
				width="12"
				height="12"
				viewBox="0 0 12 12"
				fill="currentColor"
			>
				<path
					d="M2 4l4 4 4-4"
					stroke="currentColor"
					stroke-width="2"
					fill="none"
				/>
			</svg>
		</button>

		<div v-if="isDropdownOpen" class="location-selector__dropdown">
			<input
				v-model="searchQuery"
				type="text"
				class="location-selector__search"
				:placeholder="t('SearchCity')"
				autofocus
			/>

			<ul class="location-selector__list">
				<li
					v-for="city in filteredCities"
					:key="city.id"
					class="location-selector__item"
					:class="{ 'is-active': city.name === userLocation?.city }"
					@click="selectCity(city)"
				>
					{{ city.name }}
					<span v-if="city.name !== city.name_local" class="city-local">
						({{ city.name_local }})
					</span>
				</li>
			</ul>
		</div>
	</div>
</template>

<style scoped lang="less">
.location-selector {
	position: relative;

	&__button {
		display: flex;
		align-items: center;
		gap: 8px;
		padding: 8px 12px;
		background: #fff;
		border: 1px solid #e2e8f0;
		border-radius: 8px;
		cursor: pointer;
		font-size: 14px;
		color: #334155;
		transition: all 0.2s;

		&:hover {
			border-color: #cbd5e1;
			background: #f8fafc;
		}
	}

	&__city {
		font-weight: 500;
	}

	&__dropdown {
		position: absolute;
		top: calc(100% + 4px);
		left: 0;
		min-width: 280px;
		background: #fff;
		border: 1px solid #e2e8f0;
		border-radius: 12px;
		box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
		z-index: 1000;
		padding: 8px;
	}

	&__search {
		width: 100%;
		padding: 8px 12px;
		border: 1px solid #e2e8f0;
		border-radius: 8px;
		font-size: 14px;
		margin-bottom: 8px;

		&:focus {
			outline: none;
			border-color: #4f46e5;
		}
	}

	&__list {
		max-height: 300px;
		overflow-y: auto;
		list-style: none;
		padding: 0;
		margin: 0;
	}

	&__item {
		padding: 10px 12px;
		cursor: pointer;
		border-radius: 6px;
		font-size: 14px;
		color: #334155;
		transition: background 0.15s;

		&:hover {
			background: #f1f5f9;
		}

		&.is-active {
			background: #eef2ff;
			color: #4f46e5;
			font-weight: 500;
		}
	}
}

.city-local {
	color: #94a3b8;
	font-size: 13px;
}

.location-icon,
.dropdown-arrow {
	flex-shrink: 0;
	color: #64748b;
}
</style>
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**

- [ ] AC-5.1: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –≥–æ—Ä–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] AC-5.2: –ü–æ –∫–ª–∏–∫—É –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è dropdown —Å–æ —Å–ø–∏—Å–∫–æ–º –≥–æ—Ä–æ–¥–æ–≤
- [ ] AC-5.3: –ï—Å—Ç—å –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≥–æ—Ä–æ–¥–æ–≤
- [ ] AC-5.4: –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –≥–æ—Ä–æ–¥–∞, —Å–ø–∏—Å–æ–∫ –∫–ª–∏–Ω–∏–∫ –ø–µ—Ä–µ—Å–æ—Ä—Ç–∏—Ä–æ–≤—ã–≤–∞–µ—Ç—Å—è
- [ ] AC-5.5: –¢–µ–∫—É—â–∏–π –≥–æ—Ä–æ–¥ –≤–∏–∑—É–∞–ª—å–Ω–æ –≤—ã–¥–µ–ª–µ–Ω –≤ —Å–ø–∏—Å–∫–µ
- [ ] AC-5.6: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∞–¥–∞–ø—Ç–∏–≤–µ–Ω –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤

---

### –ó–∞–¥–∞—á–∞ 6: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å LocationSelector –≤ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–ª–∏–Ω–∏–∫

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**

–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É `/pages/clinics/index.vue` –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏.

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

1. –î–æ–±–∞–≤–∏—Ç—å `LocationSelector` –≤ —Ñ–∏–ª—å—Ç—Ä—ã
2. –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ API
3. –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö –∫–ª–∏–Ω–∏–∫

```vue
<script setup lang="ts">
import { useUserLocation } from '~/composables/useUserLocation';
import { calculateDistance, formatDistance } from '~/utils/distance';

const { userLocation, detectLocation } = useUserLocation();
const { locale } = useI18n();

// –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ª–æ–∫–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
onMounted(() => {
	detectLocation();
});

// –ü–µ—Ä–µ–¥–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ API
const filterList = computed(() => ({
	cityIds: cityIds.value,
	languageIds: languageIds.value,
	name: name.value,
	locale: locale.value,
	page: pageNumber.value,
	// –î–æ–±–∞–≤–ª—è–µ–º –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é
	userLatitude: userLocation.value?.latitude,
	userLongitude: userLocation.value?.longitude,
	sortByDistance: !!userLocation.value,
}));

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
function getDistance(clinic: any): string | null {
	if (!userLocation.value || !clinic.latitude || !clinic.longitude) {
		return null;
	}

	const distanceKm = calculateDistance(
		userLocation.value.latitude,
		userLocation.value.longitude,
		clinic.latitude,
		clinic.longitude,
	);

	return formatDistance(distanceKm, locale.value);
}
</script>

<template>
	<div class="clinics-page">
		<div class="filters">
			<!-- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã -->
			<FiltersPanel />

			<!-- –ù–æ–≤—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä –ª–æ–∫–∞—Ü–∏–∏ -->
			<LocationSelector />
		</div>

		<div class="clinics-list">
			<ClinicCard
				v-for="clinic in clinicsList?.data"
				:key="clinic.id"
				:clinic="clinic"
				:distance="getDistance(clinic)"
			/>
		</div>
	</div>
</template>
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**

- [ ] AC-6.1: `LocationSelector` –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫–ª–∏–Ω–∏–∫
- [ ] AC-6.2: –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞—Ö–æ–¥–µ, –≥–æ—Ä–æ–¥ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- [ ] AC-6.3: –°–ø–∏—Å–æ–∫ –∫–ª–∏–Ω–∏–∫ —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é
- [ ] AC-6.4: –ù–∞ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö –∫–ª–∏–Ω–∏–∫ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ
- [ ] AC-6.5: –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≥–æ—Ä–æ–¥–∞, —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ—Å–æ—Ä—Ç–∏—Ä–æ–≤—ã–≤–∞–µ—Ç—Å—è

---

### –ó–∞–¥–∞—á–∞ 7: –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç ClinicCard –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**

–î–æ–±–∞–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É –∫–ª–∏–Ω–∏–∫–∏.

**–§–∞–π–ª:** `components/ClinicCard.vue`

```vue
<script setup lang="ts">
defineProps<{
	clinic: any;
	distance?: string | null;
}>();
</script>

<template>
	<div class="clinic-card">
		<!-- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ -->

		<!-- –ù–æ–≤—ã–π –±–µ–π–¥–∂ —Å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ–º -->
		<div v-if="distance" class="clinic-card__distance">
			<svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
				<path
					d="M6 0C3.9 0 2.25 1.65 2.25 3.75c0 2.625 3.75 8.25 3.75 8.25s3.75-5.625 3.75-8.25C9.75 1.65 8.1 0 6 0zm0 5.25c-.825 0-1.5-.675-1.5-1.5s.675-1.5 1.5-1.5 1.5.675 1.5 1.5-.675 1.5-1.5 1.5z"
				/>
			</svg>
			<span>{{ distance }}</span>
		</div>
	</div>
</template>

<style scoped lang="less">
.clinic-card {
	position: relative;

	&__distance {
		display: inline-flex;
		align-items: center;
		gap: 4px;
		padding: 4px 8px;
		background: #f0fdf4;
		color: #16a34a;
		border-radius: 6px;
		font-size: 13px;
		font-weight: 500;
		margin-top: 8px;

		svg {
			flex-shrink: 0;
		}
	}
}
</style>
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**

- [ ] AC-7.1: –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ –∫–ª–∏–Ω–∏–∫–∏
- [ ] AC-7.2: –ï—Å—Ç—å –∏–∫–æ–Ω–∫–∞ –º–∞—Ä–∫–µ—Ä–∞ —Ä—è–¥–æ–º —Å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ–º
- [ ] AC-7.3: –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–∫–º/–º)
- [ ] AC-7.4: –î–ª—è –∫–ª–∏–Ω–∏–∫ –±–µ–∑ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏, —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è

---

### –ó–∞–¥–∞—á–∞ 8: –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –≤ –ë–î –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**

1. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `preferred_city_id` –≤ —Ç–∞–±–ª–∏—Ü—É `users`
2. –°–æ–∑–¥–∞—Ç—å API endpoint –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≥–æ—Ä–æ–¥–∞
3. –û–±–Ω–æ–≤–∏—Ç—å `useUserLocation` –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å –ë–î

**–ú–∏–≥—Ä–∞—Ü–∏—è:** `server/sql/migrations/add_user_preferred_city.sql`

```sql
ALTER TABLE users ADD COLUMN preferred_city_id INT NULL;
ALTER TABLE users ADD FOREIGN KEY (preferred_city_id) REFERENCES cities(id) ON DELETE SET NULL;
```

**API Endpoint:** `server/api/user/set-location.post.ts`

```typescript
export default defineEventHandler(async (event) => {
	const session = await getUserSession(event);
	if (!session?.userId) {
		throw createError({ statusCode: 401, message: 'Unauthorized' });
	}

	const { cityId } = await readBody(event);
	const db = useDatabase();

	await db.sql`
    UPDATE users
    SET preferred_city_id = ${cityId}
    WHERE id = ${session.userId}
  `;

	return { success: true };
});
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**

- [ ] AC-8.1: –ü–æ–ª–µ `preferred_city_id` –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Ç–∞–±–ª–∏—Ü—É `users`
- [ ] AC-8.2: API endpoint `/api/user/set-location` —Å–æ–∑–¥–∞–Ω
- [ ] AC-8.3: –î–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≥–æ—Ä–æ–¥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î
- [ ] AC-8.4: –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞—Ö–æ–¥–µ, –≥–æ—Ä–æ–¥ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ –ë–î (–∞ –Ω–µ localStorage)

---

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏ –∏—Ç–µ—Ä–∞—Ü–∏–∏

- [ ] **AC-I2-1:** –ì–æ—Ä–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ IP –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞—Ö–æ–¥–µ
- [ ] **AC-I2-2:** –°–ø–∏—Å–æ–∫ –∫–ª–∏–Ω–∏–∫ —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é –æ—Ç –≥–æ—Ä–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] **AC-I2-3:** –ù–∞ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö –∫–ª–∏–Ω–∏–∫ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ (–∫–º/–º)
- [ ] **AC-I2-4:** –ö–æ–º–ø–æ–Ω–µ–Ω—Ç `LocationSelector` –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫–ª–∏–Ω–∏–∫
- [ ] **AC-I2-5:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—Ä—É—á–Ω—É—é –∏–∑–º–µ–Ω–∏—Ç—å —Å–≤–æ–π –≥–æ—Ä–æ–¥
- [ ] **AC-I2-6:** –í—ã–±—Ä–∞–Ω–Ω—ã–π –≥–æ—Ä–æ–¥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage –Ω–∞ 30 –¥–Ω–µ–π
- [ ] **AC-I2-7:** –î–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≥–æ—Ä–æ–¥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î
- [ ] **AC-I2-8:** –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –ù–ï —Å–∫—Ä—ã–≤–∞–µ—Ç –∫–ª–∏–Ω–∏–∫–∏ –∏–∑ –¥—Ä—É–≥–∏—Ö –≥–æ—Ä–æ–¥–æ–≤
- [ ] **AC-I2-9:** –ü—Ä–∏ –æ—à–∏–±–∫–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback (Podgorica)
- [ ] **AC-I2-10:** –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö 6 —è–∑—ã–∫–∞—Ö (–ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è)
- [ ] **AC-I2-11:** –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ < 300ms
- [ ] **AC-I2-12:** –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é < 500ms

---

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø—Ä–æ–≤–µ—Ä–∫–µ

### –¢–µ—Å—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞

1. –û—á–∏—Å—Ç–∏—Ç—å localStorage (`localStorage.clear()`)
2. –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É `/clinics` –≤ —Ä–µ–∂–∏–º–µ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≥–æ—Ä–æ–¥ –æ–ø—Ä–µ–¥–µ–ª–∏–ª—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å–ø–∏—Å–æ–∫ –∫–ª–∏–Ω–∏–∫ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –ø–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –ì–æ—Ä–æ–¥ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω, –∫–ª–∏–Ω–∏–∫–∏ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã, —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è.

---

### –¢–µ—Å—Ç 2: –†—É—á–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞

1. –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É `/clinics`
2. –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ `LocationSelector`
3. –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–π –≥–æ—Ä–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Bar)
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª—Å—è
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –ø–µ—Ä–µ—Å—á–∏—Ç–∞–ª–∏—Å—å

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –°–ø–∏—Å–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω, —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã.

---

### –¢–µ—Å—Ç 3: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –≤ localStorage

1. –í—ã–±—Ä–∞—Ç—å –≥–æ—Ä–æ–¥ –≤—Ä—É—á–Ω—É—é
2. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –≥–æ—Ä–æ–¥ —Å–æ—Ö—Ä–∞–Ω–∏–ª—Å—è
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (30 –¥–Ω–µ–π)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –ì–æ—Ä–æ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω, —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.

---

### –¢–µ—Å—Ç 4: Fallback –ø—Ä–∏ –æ—à–∏–±–∫–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏

1. –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ IP Geolocation API (DevTools ‚Üí Network ‚Üí Block)
2. –û—á–∏—Å—Ç–∏—Ç—å localStorage
3. –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É `/clinics`
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Podgorica –∫–∞–∫ fallback

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** Podgorica —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∫–∞–∫ –≥–æ—Ä–æ–¥, —Å–ø–∏—Å–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç.

---

### –¢–µ—Å—Ç 5: –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –∫–ª–∏–Ω–∏–∫–∏

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≥–æ—Ä–æ–¥ "Podgorica"
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤ —Å–ø–∏—Å–∫–µ –µ—Å—Ç—å –∫–ª–∏–Ω–∏–∫–∏ –∏–∑ –¥—Ä—É–≥–∏—Ö –≥–æ—Ä–æ–¥–æ–≤ (Bar, Budva)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫–ª–∏–Ω–∏–∫–∏ –∏–∑ Podgorica –∏–¥—É—Ç –ø–µ—Ä–≤—ã–º–∏

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ –∫–ª–∏–Ω–∏–∫–∏ –≤–∏–¥–Ω—ã, –Ω–æ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é.

---

### –¢–µ—Å—Ç 6: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö

1. –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è
2. –í—ã–±—Ä–∞—Ç—å –≥–æ—Ä–æ–¥
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ë–î, —á—Ç–æ `preferred_city_id` –æ–±–Ω–æ–≤–∏–ª—Å—è
4. –í—ã–π—Ç–∏ –∏ –∑–∞–π—Ç–∏ —Å–Ω–æ–≤–∞
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≥–æ—Ä–æ–¥ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è –∏–∑ –ë–î

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –ì–æ—Ä–æ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –ë–î –∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –≤—Ö–æ–¥–µ.

---

## –°—Ç–∞—Ç—É—Å

üî¥ **Not Started**

---

[‚Üê –ö —Å–ø–∏—Å–∫—É –∏—Ç–µ—Ä–∞—Ü–∏–π](README.md) | [‚Üê –ö –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é PRD](../index.md)
