# 2. Требования

[← Назад к оглавлению](index.md)

---

## 2.1 Функциональные требования

### FR-1: Структура графика работы

- FR-1.1: График работы хранится для каждого дня недели (понедельник - воскресенье)
- FR-1.2: Каждый день может иметь один из типов:
  - `regular` - обычный рабочий день с указанием временных интервалов
  - `24/7` - круглосуточная работа
  - `closed` - выходной день
  - `on_demand` - по требованию (по предварительной записи)
  - `not_specified` - график не указан
- FR-1.3: Для типа `regular` можно указать до 3 временных интервалов
- FR-1.4: Каждый временной интервал имеет время начала и окончания (HH:mm формат)
- FR-1.5: Интервалы не должны пересекаться в рамках одного дня

### FR-2: Редактирование графика

- FR-2.1: Администратор клиники может редактировать график работы своей клиники
- FR-2.2: Редактор графика предоставляет:
  - Выбор типа дня для каждого дня недели
  - Добавление/удаление временных интервалов
  - Выбор времени через time picker
  - Кнопку "Копировать на все дни"
  - Кнопку "Копировать на рабочие дни (Пн-Пт)"
  - Кнопку "Копировать на выходные (Сб-Вс)"
- FR-2.3: Изменения сохраняются только после нажатия кнопки "Сохранить"
- FR-2.4: Возможность отмены изменений кнопкой "Отменить"
- FR-2.5: Валидация данных перед сохранением:
  - Проверка формата времени
  - Проверка, что время начала < времени окончания
  - Проверка отсутствия пересечений интервалов

### FR-3: Отображение графика на публичной странице

- FR-3.1: График работы отображается на странице клиники
- FR-3.2: Отображается статус "Открыто сейчас" / "Закрыто" с учетом текущего времени
- FR-3.3: Для статуса "Открыто" показывается время до закрытия
- FR-3.4: Для статуса "Закрыто" показывается время открытия
- FR-3.5: Отображается список дней недели с графиком
- FR-3.6: Текущий день выделяется визуально
- FR-3.7: Для типа `24/7` отображается "Круглосуточно"
- FR-3.8: Для типа `closed` отображается "Выходной"
- FR-3.9: Для типа `on_demand` отображается "По требованию"
- FR-3.10: Для типа `not_specified` отображается "Уточняйте по телефону"
- FR-3.11: Множественные интервалы отображаются через запятую

### FR-4: API endpoints

- FR-4.1: `GET /api/clinics/[id]/working-hours` - получение графика работы
  - Публичный endpoint (не требует авторизации)
  - Возвращает график для всех дней недели
- FR-4.2: `PUT /api/clinics/[id]/working-hours` - обновление графика работы
  - Требует авторизации
  - Требует роль `clinic_admin` для данной клиники
  - Валидирует данные перед сохранением
  - Возвращает обновленный график

### FR-5: Многоязычность

- FR-5.1: Названия дней недели локализуются
- FR-5.2: Статусы локализуются ("Открыто", "Закрыто", и т.д.)
- FR-5.3: Поддерживаются языки: ru, en, sr, sr-Cyrl, de, tr

## 2.2 Нефункциональные требования

### NFR-1: Производительность

- NFR-1.1: Загрузка графика работы < 100ms
- NFR-1.2: Сохранение графика работы < 500ms
- NFR-1.3: Расчет статуса "Открыто/Закрыто" < 10ms

### NFR-2: Юзабилити

- NFR-2.1: Редактирование полного графика < 5 минут
- NFR-2.2: Интерфейс интуитивно понятен без инструкций
- NFR-2.3: Мобильный дизайн (responsive)
- NFR-2.4: Доступность (WCAG 2.1 Level AA)

### NFR-3: Надежность

- NFR-3.1: Валидация данных на клиенте и сервере
- NFR-3.2: Обработка ошибок с понятными сообщениями
- NFR-3.3: Откат изменений при ошибке сохранения
- NFR-3.4: 99.9% uptime API

### NFR-4: Безопасность

- NFR-4.1: Редактирование только для авторизованных администраторов клиники
- NFR-4.2: Проверка прав доступа на сервере
- NFR-4.3: Защита от CSRF
- NFR-4.4: Санитизация входных данных

### NFR-5: Масштабируемость

- NFR-5.1: Поддержка до 10,000 клиник
- NFR-5.2: Компактное хранение данных (< 1KB на клинику)
- NFR-5.3: Эффективные запросы к БД (использование индексов)

### NFR-6: Совместимость

- NFR-6.1: Поддержка браузеров: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- NFR-6.2: Поддержка мобильных браузеров: iOS Safari 14+, Android Chrome 90+

## 2.3 Scope (что включено / что НЕ включено)

### Включено

✅ Гибкий график работы по дням недели  
✅ Режим 24/7  
✅ Множественные интервалы в день (до 3)  
✅ Специальные режимы ("по требованию", "не указано")  
✅ Редактор графика для администраторов клиники  
✅ Отображение графика на публичной странице  
✅ Статус "Открыто/Закрыто" в реальном времени  
✅ Копирование графика между днями  
✅ Валидация данных  
✅ Локализация (6 языков)

### НЕ включено (out of scope)

❌ Индивидуальный график для врачей  
❌ Исключения (праздники, отпуска)  
❌ История изменений графика  
❌ Уведомления об изменении графика  
❌ Онлайн-запись на прием  
❌ Интеграция с внешними календарями  
❌ Автоматическое определение праздников  
❌ Поддержка часовых поясов  
❌ Мобильное приложение для редактирования  
❌ Массовое редактирование графика для нескольких клиник

## 2.4 Пользовательские сценарии (Use Cases)

### UC-1: Администратор создает график работы

**Актор:** Администратор клиники  
**Цель:** Заполнить график работы клиники

**Основной сценарий:**

1. Администратор переходит в раздел "Редактирование клиники"
2. Открывает вкладку "График работы"
3. Для каждого дня недели:
   - Выбирает тип дня (regular / 24/7 / closed / on_demand / not_specified)
   - Если regular - добавляет временные интервалы
4. Использует кнопку "Копировать на рабочие дни" для Пн-Пт
5. Для Сб-Вс устанавливает отдельный график
6. Нажимает "Сохранить"
7. Система валидирует данные и сохраняет график
8. Показывается сообщение об успешном сохранении

### UC-2: Администратор меняет график работы

**Актор:** Администратор клиники  
**Цель:** Обновить график работы

**Основной сценарий:**

1. Администратор переходит в раздел "Редактирование клиники"
2. Открывает вкладку "График работы"
3. Видит текущий график
4. Изменяет нужные дни
5. Нажимает "Сохранить"
6. Система сохраняет изменения
7. Обновленный график отображается на публичной странице

**Альтернативный сценарий (ошибка валидации):**

4a. Администратор вводит некорректные данные (время начала > времени окончания)  
5a. Нажимает "Сохранить"  
6a. Система показывает ошибку валидации  
7a. Администратор исправляет ошибку  
8a. Возврат к шагу 5

### UC-3: Пользователь просматривает график работы

**Актор:** Посетитель сайта  
**Цель:** Узнать, когда работает клиника

**Основной сценарий:**

1. Пользователь открывает страницу клиники
2. Видит блок "График работы"
3. Видит статус "Открыто сейчас" или "Закрыто"
4. Видит список дней недели с графиком
5. Текущий день выделен
6. Пользователь планирует визит

### UC-4: Клиника работает круглосуточно

**Актор:** Администратор клиники  
**Цель:** Установить режим 24/7

**Основной сценарий:**

1. Администратор переходит в "График работы"
2. Для всех дней недели выбирает тип "24/7"
3. Использует кнопку "Копировать на все дни"
4. Нажимает "Сохранить"
5. На публичной странице отображается "Круглосуточно" для всех дней
6. Статус всегда "Открыто сейчас"

### UC-5: Клиника работает с перерывом

**Актор:** Администратор клиники  
**Цель:** Установить график с перерывом на обед

**Основной сценарий:**

1. Администратор переходит в "График работы"
2. Для рабочих дней (Пн-Пт):
   - Выбирает тип "regular"
   - Добавляет интервал 1: 09:00 - 13:00
   - Добавляет интервал 2: 15:00 - 19:00
3. Использует кнопку "Копировать на рабочие дни"
4. Для выходных устанавливает "Выходной"
5. Нажимает "Сохранить"
6. На публичной странице отображается: "09:00-13:00, 15:00-19:00"

---

**Предыдущий раздел:** [← 1. Обзор](01-overview.md)  
**Следующий раздел:** [3. Архитектура →](03-architecture.md)
