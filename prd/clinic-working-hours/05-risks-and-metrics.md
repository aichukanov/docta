# 5. Риски и метрики

[← Назад к оглавлению](index.md)

---

## 5.1 Риски и митигация

| Риск                                                | Вероятность | Влияние | Митигация                                                                                      |
| --------------------------------------------------- | ----------- | ------- | ---------------------------------------------------------------------------------------------- |
| Администраторы не заполняют график работы           | Средняя     | Высокое | Напоминания в UI, автоматическое напоминание по email, показывать статистику заполненности     |
| Администраторы указывают некорректный график        | Средняя     | Среднее | Валидация на клиенте и сервере, предпросмотр перед сохранением                                 |
| Часовые пояса не учитываются                        | Низкая      | Среднее | В первой версии используется локальное время, в следующей версии - добавить поддержку timezone |
| UI редактора слишком сложный                        | Средняя     | Высокое | UX-тестирование, упрощение интерфейса, добавление подсказок                                    |
| JSON поля в MySQL могут быть медленными             | Низкая      | Низкое  | Индексация clinic_id, мониторинг производительности, миграция на нормализованную структуру     |
| Пользователи не видят график на странице клиники    | Низкая      | Среднее | Привлекательный дизайн блока, размещение в видимой области                                     |
| Сложность расчета статуса "Открыто/Закрыто"         | Низкая      | Низкое  | Тщательное тестирование граничных случаев, unit-тесты                                          |
| Перекрывающиеся интервалы из-за ошибки пользователя | Средняя     | Низкое  | Валидация на клиенте и сервере, визуальная обратная связь при пересечении                      |

---

## 5.2 Метрики успеха

### Adoption метрики (первые 3 месяца)

| Метрика                                        | Цель | Способ измерения                       |
| ---------------------------------------------- | ---- | -------------------------------------- |
| % клиник с заполненным графиком                | 70%  | `COUNT(*) / total_clinics` из БД       |
| % клиник с режимом "не указано"                | < 5% | Подсчет JSON с `type: "not_specified"` |
| % клиник с режимом 24/7                        | ~15% | Подсчет JSON с `type: "24/7"`          |
| Среднее время заполнения графика               | < 3m | Tracking событий в UI (начало/конец)   |
| % клиник, использующих множественные интервалы | ~40% | Подсчет JSON с `intervals.length > 1`  |

### Качество метрики

| Метрика                                     | Цель  | Способ измерения                            |
| ------------------------------------------- | ----- | ------------------------------------------- |
| % графиков с ошибками валидации             | < 1%  | Логирование ошибок валидации при сохранении |
| % использования "по требованию"             | < 10% | Подсчет JSON с `type: "on_demand"`          |
| Средняя длительность рабочего дня (regular) | 8-12h | Расчет из интервалов                        |

### Engagement метрики

| Метрика                                | Baseline | Цель       | Способ измерения                         |
| -------------------------------------- | -------- | ---------- | ---------------------------------------- |
| Просмотры блока "График работы"        | -        | Tracking   | Google Analytics / собственная аналитика |
| Клики на "Позвонить" в рабочее время   | -        | Увеличение | Tracking кликов с проверкой статуса      |
| Клики на "Позвонить" в нерабочее время | -        | Снижение   | Tracking кликов с проверкой статуса      |

### Retention метрики (после 3 месяцев)

| Метрика                                | Цель    | Способ измерения           |
| -------------------------------------- | ------- | -------------------------- |
| % клиник, не меняющих график 3+ месяца | 80%     | Проверка `updated_at` в БД |
| Частота изменений графика              | < 1/мес | Логирование обновлений     |

---

## 5.3 Мониторинг и алерты

### Технические метрики

| Метрика                                          | Threshold | Алерт                            |
| ------------------------------------------------ | --------- | -------------------------------- |
| Время ответа GET /api/clinics/[id]/working-hours | > 100ms   | Warning                          |
| Время ответа PUT /api/clinics/[id]/working-hours | > 500ms   | Warning                          |
| Ошибки валидации при сохранении                  | > 5%      | Warning (возможна проблема в UI) |
| 500 ошибки API                                   | > 0.1%    | Critical                         |
| Размер таблицы clinic_working_hours              | > 100MB   | Info (планировать оптимизацию)   |

### Бизнес-метрики (дашборд)

- Количество клиник с заполненным графиком (daily)
- Распределение типов дней (regular / 24/7 / closed / ...)
- Топ-10 самых популярных графиков работы
- Количество изменений графика за последние 7 дней
- % клиник, не обновлявших график > 6 месяцев

---

## 5.4 A/B тесты (опционально)

### Тест 1: Размещение блока "График работы"

**Гипотеза:** Размещение графика работы выше на странице увеличивает вовлеченность.

**Варианты:**

- A: График работы в правой колонке (ниже контактов)
- B: График работы в правой колонке (выше контактов)

**Метрики:**

- % просмотров блока графика
- Время до первого клика на "Позвонить"

### Тест 2: Дизайн блока "График работы"

**Гипотеза:** Выделение текущего дня цветом увеличивает понимание графика.

**Варианты:**

- A: Без выделения текущего дня
- B: Выделение текущего дня цветом (зеленый для открыто, серый для закрыто)

**Метрики:**

- % пользователей, раскрывающих полный график
- Время на странице клиники

---

## 5.5 Вопросы для уточнения

- [ ] **Q1:** Нужна ли поддержка часовых поясов для клиник в разных странах?
  - **Решение:** В первой версии - нет, используем локальное время города
- [ ] **Q2:** Нужна ли история изменений графика работы?
  - **Решение:** В первой версии - нет, добавить в следующей версии
- [ ] **Q3:** Нужны ли уведомления администраторам клиники о необходимости заполнить график?
  - **Решение:** В первой версии - показывать напоминание в UI, email-уведомления - в следующей версии
- [ ] **Q4:** Как обрабатывать праздничные дни?
  - **Решение:** В первой версии - не поддерживаются, добавить "Исключения" в следующей версии
- [ ] **Q5:** Нужно ли показывать график работы в списке клиник (поиск/фильтры)?
  - **Решение:** В первой версии - нет, только на странице клиники. Добавить фильтр "Открыто сейчас" в следующей версии
- [ ] **Q6:** Нужна ли возможность скопировать график одной клиники на другую?
  - **Решение:** В первой версии - нет, только копирование между днями в рамках одной клиники
- [ ] **Q7:** Как обрабатывать клиники без заполненного графика?
  - **Решение:** Дефолтное значение - `not_specified` для всех дней (отображается "Уточняйте по телефону")

---

## 5.6 План rollout

### Фаза 1: Разработка и тестирование (Итерации 1-4)

- Разработка базы данных
- Разработка API endpoints
- Разработка UI компонентов
- Unit-тесты и E2E тесты
- Внутреннее QA тестирование

### Фаза 2: Мягкий запуск (Soft Launch)

- Включить функцию для 10% клиник (A/B тест)
- Мониторинг метрик adoption и engagement
- Сбор обратной связи от администраторов клиник
- Исправление багов и UX улучшения

### Фаза 3: Полный запуск (Full Launch)

- Включить функцию для всех клиник
- Email-рассылка администраторам клиник (инструкция по заполнению графика)
- Мониторинг метрик
- Оптимизация на основе данных

### Фаза 4: Оптимизация

- Анализ использования (какие типы графиков популярны)
- Добавление preset'ов на основе данных
- Улучшение UX редактора
- Планирование следующей версии (исключения, часовые пояса, и т.д.)

---

## 5.7 Критерии успеха всего PRD

Проект считается успешным, если через 3 месяца после запуска:

✅ **70%+ клиник** заполнили график работы  
✅ **< 5% клиник** используют режим "не указано"  
✅ **Средний NPS** от администраторов клиник ≥ 8  
✅ **Нет критичных багов** в production  
✅ **Время загрузки API** < 100ms (p95)  
✅ **Engagement:** просмотры блока графика > 50% от просмотров страниц клиник

---

**Предыдущий раздел:** [← 4. База данных](04-database.md)  
**Назад к оглавлению:** [← index.md](index.md)
