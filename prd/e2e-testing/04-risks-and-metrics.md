# 4. Риски и метрики

[← Назад к оглавлению](index.md)

---

## 4.1 Риски и митигация

| Риск                                            | Вероятность | Влияние | Митигация                                                                                                                                                |
| ----------------------------------------------- | ----------- | ------- | -------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Тесты флакают из-за таймингов (race conditions) | Средняя     | Среднее | Использовать правильные ожидания Playwright (waitForSelector, waitForLoadState), добавить retry механизм (2 попытки)                                     |
| Различия между локальным и продакшен окружением | Средняя     | Среднее | Регулярно запускать тесты на обоих окружениях, использовать переменные окружения для настройки, документировать различия                                 |
| Изменения в UI ломают селекторы                 | Высокая     | Высокое | Использовать data-testid атрибуты для критических элементов, использовать более устойчивые селекторы (role, text), Page Object Model изолирует изменения |
| Медленное выполнение тестов                     | Низкая      | Среднее | Запускать тесты параллельно (workers), оптимизировать ожидания, использовать только Chromium для быстрых прогонов                                        |
| Недостаточное покрытие edge cases               | Средняя     | Низкое  | Начать с happy path, постепенно добавлять edge cases в отдельных итерациях после основного покрытия                                                      |
| Отсутствие тестовых данных в БД                 | Низкая      | Высокое | Убедиться что есть достаточно данных для всех типов сущностей, тесты должны проверять наличие хотя бы одного элемента                                    |
| Тесты проходят локально, но падают на проде     | Средняя     | Среднее | Использовать те же селекторы и логику, учитывать возможные задержки сети на проде (увеличить таймауты)                                                   |

---

## 4.2 Метрики успеха

### Покрытие функциональности

- ✅ **100% основных страниц** покрыты тестами (главная, списки, детальные)
- ✅ **100% навигационных элементов** покрыты (хедер, футер)
- ✅ **Пагинация** работает на всех страницах списков
- ✅ **Переключение языка** работает корректно
- ✅ **Кнопка "К поиску"** работает на всех детальных страницах

**Целевое значение:** 11+ страниц покрыто тестами

### Качество тестов

- ✅ **Все тесты проходят** на обоих окружениях (local + prod)
- ✅ **Flakiness rate < 5%** (менее 5% тестов нестабильны)
- ✅ **Pass rate > 95%** (более 95% тестов проходят успешно)

**Целевое значение:** 0 флаки-тестов в течение 10 запусков

### Производительность

- ✅ **Среднее время выполнения** всех тестов < 5 минут
- ✅ **Время выполнения одного теста** < 30 секунд

**Целевое значение:** Полный прогон за 3-4 минуты

### Процесс

- ✅ **Тесты запускаются** одной командой
- ✅ **Отчеты генерируются** автоматически
- ✅ **Документация** по запуску тестов создана и понятна

**Целевое значение:** Новый разработчик может запустить тесты за < 5 минут

### Покрытие тестами (детально)

| Тип страницы | Количество | Статус покрытия |
| ------------ | ---------- | --------------- |
| Главная      | 1          | ⏳ Не покрыта   |
| Списки       | 5          | ⏳ Не покрыты   |
| Детальные    | 5          | ⏳ Не покрыты   |
| Навигация    | 2          | ⏳ Не покрыта   |
| **Всего**    | **13**     | **0/13 (0%)**   |

---

## 4.3 Критерии готовности к релизу

### Must Have (обязательно для релиза)

- [ ] Все 6 итераций завершены
- [ ] Все тесты проходят на localhost:3000
- [ ] Все тесты проходят на https://docta.me
- [ ] HTML отчеты генерируются
- [ ] Документация создана (README в папке tests/)
- [ ] npm скрипты работают корректно

### Should Have (желательно, но не блокирует релиз)

- [ ] Flakiness rate < 5%
- [ ] Среднее время выполнения < 5 минут
- [ ] Скриншоты и видео при падении настроены
- [ ] CI/CD интеграция (опционально)

### Nice to Have (можно добавить позже)

- [ ] Тесты в Firefox и WebKit
- [ ] Визуальное регрессионное тестирование
- [ ] Тесты производительности
- [ ] Мобильная версия

---

## 4.4 Вопросы для уточнения

### Технические вопросы

- [x] **Какие браузеры нужно поддерживать?**

  - **Ответ:** Chromium (основной), Firefox и WebKit опционально

- [x] **Нужна ли интеграция с CI/CD на текущем этапе?**

  - **Ответ:** Опционально в последней итерации, не блокирует релиз

- [x] **Есть ли специфические селекторы или data-testid атрибуты уже в коде?**

  - **Ответ:** Нужно добавить при необходимости для критических элементов

- [x] **Нужно ли тестировать мобильную версию (responsive)?**

  - **Ответ:** Пока нет, можно добавить в будущем

- [ ] **Какой минимальный набор данных должен быть в БД для тестов?**
  - **Нужно уточнить:** Сколько клиник, врачей, услуг и т.д. должно быть минимум для стабильных тестов?

### Процессные вопросы

- [ ] **Как часто нужно запускать тесты?**

  - **Варианты:** При каждом коммите, перед релизом, ежедневно?

- [ ] **Кто будет отвечать за поддержку тестов?**

  - **Нужно назначить:** Owner для поддержки и обновления тестов

- [ ] **Что делать если тесты на проде падают?**
  - **Нужно определить:** Процесс реагирования на падение продакшн тестов

---

**Предыдущий раздел:** [← 3. Архитектура](03-architecture.md)  
**Вернуться к началу:** [↑ Оглавление](index.md)
