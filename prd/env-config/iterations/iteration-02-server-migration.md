# –ò—Ç–µ—Ä–∞—Ü–∏—è 2: –ú–∏–≥—Ä–∞—Ü–∏—è server-side –∫–æ–¥–∞

[‚Üê –ù–∞–∑–∞–¥ –∫ –∏—Ç–µ—Ä–∞—Ü–∏—è–º](README.md) | [‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è: –ò—Ç–µ—Ä–∞—Ü–∏—è 1](iteration-01-audit.md)

---

## –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏—Ç–µ—Ä–∞—Ü–∏–∏

**–°—Ç–∞—Ç—É—Å:** üî¥ Not Started  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0 (–∫—Ä–∏—Ç–∏—á–Ω–æ)  
**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:** 2-3 —á–∞—Å–∞

---

## –¶–µ–ª—å

–ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—É—é —á–∞—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å `useRuntimeConfig()` –Ω–∞ –ø—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `process.env`.

**–§–∞–π–ª—ã –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏:**

- `server/common/db-mysql.ts` - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
- –î—Ä—É–≥–∏–µ server utils (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç runtimeConfig)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- ‚úÖ –°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ `process.env`
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –í—Å–µ server-side —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç

---

## –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è

- ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∞ [–ò—Ç–µ—Ä–∞—Ü–∏—è 1: –ê—É–¥–∏—Ç –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞](iteration-01-audit.md)
- ‚úÖ –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `types/env.d.ts`
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —É—Ç–∏–ª–∏—Ç–∞ `server/utils/validate-env.ts`
- ‚úÖ –ï—Å—Ç—å –ø–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏

---

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–û—Ç —á–µ–≥–æ –∑–∞–≤–∏—Å–∏—Ç:**

- –ò—Ç–µ—Ä–∞—Ü–∏—è 1 (—Ç–∏–ø—ã –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω—ã)

**–ß—Ç–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —ç—Ç–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏:**

- –ò—Ç–µ—Ä–∞—Ü–∏—è 3 (client-side –º–∏–≥—Ä–∞—Ü–∏—è)

---

## –ó–∞–¥–∞—á–∏

### –ó–∞–¥–∞—á–∞ 2.1: –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å server/common/db-mysql.ts

**–¶–µ–ª—å:** –ó–∞–º–µ–Ω–∏—Ç—å `useRuntimeConfig()` –Ω–∞ `process.env` –≤ —Ñ–∞–π–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**

```typescript
import mysql from 'mysql2/promise';

let pool: mysql.Pool | null = null;

export async function getConnection() {
	try {
		const config = useRuntimeConfig(); // ‚ùå –£–±—Ä–∞—Ç—å
		const { host, user, password } = config.public.connection; // ‚ùå –£–±—Ä–∞—Ç—å

		if (!pool) {
			pool = mysql.createPool({
				host,
				user,
				password,
				database: 'docta_me',
				port: 3306,
				waitForConnections: true,
				connectionLimit: 10,
				queueLimit: 0,
				charset: 'utf8mb4',
				timezone: '+00:00',
			});
		}

		const connection = await pool.getConnection();
		const originalEnd = connection.end.bind(connection);
		(connection as any).end = async function () {
			connection.release();
		};
		return connection;
	} catch (error) {
		console.error('Database connection error:', error);
		throw error;
	}
}
```

**–ù–æ–≤—ã–π –∫–æ–¥:**

```typescript
import mysql from 'mysql2/promise';

let pool: mysql.Pool | null = null;

export async function getConnection() {
	try {
		// ‚úÖ –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ process.env
		const host = process.env.DB_HOST;
		const user = process.env.DB_USER;
		const password = process.env.DB_PASSWORD;

		if (!pool) {
			pool = mysql.createPool({
				host,
				user,
				password,
				database: 'docta_me',
				port: 3306,
				waitForConnections: true,
				connectionLimit: 10,
				queueLimit: 0,
				charset: 'utf8mb4',
				timezone: '+00:00',
			});
		}

		const connection = await pool.getConnection();
		const originalEnd = connection.end.bind(connection);
		(connection as any).end = async function () {
			connection.release();
		};
		return connection;
	} catch (error) {
		console.error('Database connection error:', error);
		throw error;
	}
}
```

**–®–∞–≥–∏:**

1. –û—Ç–∫—Ä—ã—Ç—å `server/common/db-mysql.ts`
2. –£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É `const config = useRuntimeConfig();`
3. –ó–∞–º–µ–Ω–∏—Ç—å `config.public.connection.host` –Ω–∞ `process.env.DB_HOST`
4. –ó–∞–º–µ–Ω–∏—Ç—å `config.public.connection.user` –Ω–∞ `process.env.DB_USER`
5. –ó–∞–º–µ–Ω–∏—Ç—å `config.public.connection.password` –Ω–∞ `process.env.DB_PASSWORD`
6. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª
7. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ TypeScript –æ—à–∏–±–æ–∫

**AC-2.1:**

- ‚úÖ –§–∞–π–ª `server/common/db-mysql.ts` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `useRuntimeConfig()`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `process.env.DB_HOST`, `DB_USER`, `DB_PASSWORD`
- ‚úÖ –ù–µ—Ç TypeScript –æ—à–∏–±–æ–∫
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ dev —Ä–µ–∂–∏–º–µ)

---

### –ó–∞–¥–∞—á–∞ 2.2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥—Ä—É–≥–∏–µ server utils

**–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `useRuntimeConfig`

**–®–∞–≥–∏:**

1. –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–∏—Å–∫ –≤ server/:

```bash
grep -r "useRuntimeConfig" server/ --include="*.ts" --include="*.js"
```

2. –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è - –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –ó–∞–¥–∞—á–µ 2.1:
   - –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
   - –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ `process.env.VARIABLE_NAME`
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

**–û–∂–∏–¥–∞–µ–º—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- `server/utils/email.ts` - –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SMTP –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
- `server/utils/oauth-config.ts` - –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å OAuth –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
- –õ—é–±—ã–µ –¥—Ä—É–≥–∏–µ utils

**AC-2.2:**

- ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –≤—Å–µ —Ñ–∞–π–ª—ã –≤ `server/`
- ‚úÖ –í—Å–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `useRuntimeConfig` –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ –ò–ª–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ, —á—Ç–æ –¥—Ä—É–≥–∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π –Ω–µ—Ç

---

### –ó–∞–¥–∞—á–∞ 2.3: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é env –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

**–¶–µ–ª—å:** –í—ã–∑—ã–≤–∞—Ç—å `validateEnv()` –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ Nitro —Å–µ—Ä–≤–µ—Ä–∞

**–®–∞–≥–∏:**

1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `server/plugins/init.ts`:

```typescript
import { validateEnv } from '../utils/validate-env';

export default defineNitroPlugin((nitroApp) => {
	// –í–∞–ª–∏–¥–∏—Ä—É–µ–º env –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞
	validateEnv();
});
```

2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:

```bash
npm run dev
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**

```
‚úÖ Environment variables validated successfully
```

3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

```bash
# –í—Ä–µ–º–µ–Ω–Ω–æ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –≤ .env
# DB_HOST=localhost ‚Üí DB_HOST_TEMP=localhost

npm run dev

# –î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –æ—à–∏–±–∫–∞:
# ‚ùå Environment validation failed:
# Missing variables: DB_HOST
```

**AC-2.3:**

- ‚úÖ –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `server/plugins/init.ts`
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—ã–≤–æ–¥–∏—Ç—Å—è ‚úÖ —Å–æ–æ–±—â–µ–Ω–∏–µ
- ‚úÖ –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å —è—Å–Ω–æ–π –æ—à–∏–±–∫–æ–π

---

### –ó–∞–¥–∞—á–∞ 2.4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ server-side —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

**–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

**–®–∞–≥–∏:**

1. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î:**

   - –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: `npm run dev`
   - –û—Ç–∫—Ä—ã—Ç—å –ª—é–±—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É, –∫–æ—Ç–æ—Ä–∞—è –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ –ë–î
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ - –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

2. **API endpoints:**

   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ API endpoints —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä –∏–ª–∏ Postman
   - –ù–∞–ø—Ä–∏–º–µ—Ä: `/api/auth/login`, `/api/clinics`, –∏ —Ç.–¥.
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç

3. **–õ–æ–≥–∏:**

   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ - –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `‚úÖ Environment variables validated successfully` –≤ –ª–æ–≥–∞—Ö

**AC-2.4:**

- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ API endpoints –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è env –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ

---

## Acceptance Criteria (–æ–±—â–∏–µ –¥–ª—è –∏—Ç–µ—Ä–∞—Ü–∏–∏)

- ‚úÖ **AC-2.1:** `server/common/db-mysql.ts` –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω –Ω–∞ `process.env`
- ‚úÖ **AC-2.2:** –í—Å–µ server utils –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –∏ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ **AC-2.3:** –í–∞–ª–∏–¥–∞—Ü–∏—è env –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ `server/plugins/init.ts`
- ‚úÖ **AC-2.4:** –í—Å–µ server-side —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –ù–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π `useRuntimeConfig` –≤ `server/`
- ‚úÖ TypeScript –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏

### Checklist

**–ö–æ–¥:**

- [ ] `server/common/db-mysql.ts` –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω
- [ ] –î—Ä—É–≥–∏–µ server utils –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã/–º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –°–æ–∑–¥–∞–Ω `server/plugins/init.ts`
- [ ] –ü–æ–∏—Å–∫ `useRuntimeConfig` –≤ `server/` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- [ ] TypeScript –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è: `npm run build`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**

- [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è: `npm run dev`
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è env –≤—ã–≤–æ–¥–∏—Ç ‚úÖ —Å–æ–æ–±—â–µ–Ω–∏–µ
- [ ] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª—é–±—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –¥–∞–Ω–Ω—ã–º–∏)
- [ ] API endpoints —Ä–∞–±–æ—Ç–∞—é—Ç (–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å 2-3 endpoint)
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–∞–Ω–¥—ã:**

```bash
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å 0 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
grep -r "useRuntimeConfig" server/ --include="*.ts" --include="*.js"

# –î–æ–ª–∂–µ–Ω –Ω–∞–π—Ç–∏ –Ω–æ–≤—ã–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è process.env
grep -r "process.env.DB_" server/ --include="*.ts"
```

---

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**

1. –û–ø–µ—á–∞—Ç–∫–∞ –≤ –∏–º–µ–Ω–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
2. –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –≤ .env
3. –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –ø—É—Å—Ç–∞

**–†–µ—à–µ–Ω–∏–µ:**

```typescript
// –î–æ–±–∞–≤–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π debug
const host = process.env.DB_HOST;
const user = process.env.DB_USER;
const password = process.env.DB_PASSWORD;

console.log('DB Config:', {
	host,
	user,
	password: password ? '***' : undefined,
});
```

### –ü—Ä–æ–±–ª–µ–º–∞: TypeScript –æ—à–∏–±–∫–∞ "Property 'DB_HOST' does not exist"

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `types/env.d.ts` —Å–æ–∑–¥–∞–Ω
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `types/env.d.ts` –≤–∫–ª—é—á–µ–Ω –≤ `tsconfig.json`
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å TypeScript —Å–µ—Ä–≤–µ—Ä –≤ IDE

### –ü—Ä–æ–±–ª–µ–º–∞: –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ñ–∞–π–ª `server/plugins/init.ts` —Å–æ–∑–¥–∞–Ω
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ñ–∞–π–ª —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `defineNitroPlugin`
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å dev —Å–µ—Ä–≤–µ—Ä

---

## –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:

```bash
# –û—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ db-mysql.ts
git checkout HEAD -- server/common/db-mysql.ts

# –£–¥–∞–ª–∏—Ç—å server/plugins/init.ts
rm server/plugins/init.ts

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
npm run dev
```

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —ç—Ç–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏:

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ Acceptance Criteria
2. –°–æ–∑–¥–∞—Ç—å commit: `feat: migrate server-side code to process.env`
3. –ü–µ—Ä–µ–π—Ç–∏ –∫ [–ò—Ç–µ—Ä–∞—Ü–∏–∏ 3: –ú–∏–≥—Ä–∞—Ü–∏—è client-side –∫–æ–¥–∞](iteration-03-client-migration.md)

---

[‚Üê –ù–∞–∑–∞–¥ –∫ –∏—Ç–µ—Ä–∞—Ü–∏—è–º](README.md) | [‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è: –ò—Ç–µ—Ä–∞—Ü–∏—è 1](iteration-01-audit.md) | [–î–∞–ª–µ–µ: –ò—Ç–µ—Ä–∞—Ü–∏—è 3 ‚Üí](iteration-03-client-migration.md)
