# 2. Требования

[← Назад к оглавлению](index.md)

---

## 2.1 Функциональные требования

### FR-1: Создание внутренних отзывов

- Авторизованный пользователь может оставить отзыв на врача
- Авторизованный пользователь может оставить отзыв на клинику
- Отзыв содержит:
  - Общую оценку (1-5 звезд, обязательно)
  - Текст отзыва (опционально, мин. 10 символов)
  - Дополнительные оценки по критериям (опционально):
    - Профессионализм (1-5 звезд)
    - Отношение к пациентам (1-5 звезд)
    - Качество обслуживания (1-5 звезд)
    - Соотношение цена/качество (1-5 звезд)
- Пользователь может оставить только 1 отзыв на врача/клинику
- Отзыв можно редактировать в течение 7 дней после создания
- После создания отзыв отправляется на модерацию

### FR-2: Верификация отзывов

- Пользователь может прикрепить к отзыву файл верификации:
  - Чек об оплате услуг
  - Направление/назначение врача
  - Медицинская справка
- Форматы файлов: JPG, PNG, PDF (макс. 5MB)
- Верификация проверяется модератором вручную
- При одобрении отзыв получает статус "Verified"
- Verified badge отображается на отзыве

### FR-3: Внешние отзывы

- Суперадмин может добавить внешний отзыв
- Внешний отзыв содержит:
  - Источник (Facebook, Google Maps, Booking, и т.д.)
  - URL источника (опционально)
  - Имя автора (как указано на внешней платформе)
  - Дата отзыва
  - Оценка (1-5 звезд)
  - Текст отзыва
  - Язык отзыва
- Внешние отзывы имеют статус "External"
- Внешние отзывы нельзя редактировать
- Внешние отзывы участвуют в расчете среднего рейтинга

### FR-4: Отображение отзывов

- На странице врача отображаются все отзывы (внутренние + внешние)
- На странице клиники отображаются все отзывы (внутренние + внешние)
- Сортировка отзывов:
  - По дате (новые сначала) - по умолчанию
  - По рейтингу (высокие сначала)
  - По рейтингу (низкие сначала)
  - Verified отзывы сначала
- Фильтрация отзывов:
  - Только внутренние
  - Только внешние
  - Только верифицированные
  - По оценке (5 звезд, 4 звезды, и т.д.)
- Пагинация: 10 отзывов на страницу

### FR-5: AI Summary отзывов

- Генерация AI Summary на основе всех отзывов по запросу (через E2E тест)
- AI Summary содержит:
  - Общее впечатление (позитивное/негативное/нейтральное)
  - Ключевые положительные моменты (3-5 пунктов)
  - Ключевые проблемы (если есть) (0-5 пунктов)
  - Рекомендации для потенциальных пациентов
- AI Summary обновляется вручную через запуск E2E теста
- E2E тест обрабатывает всех врачей/клиники с отзывами и обновляет БД
- AI Summary учитывает как внутренние, так и внешние отзывы
- Язык AI Summary зависит от языка интерфейса пользователя
- Модель AI (например, GPT-4) настраивается в E2E тесте

### FR-6: Рейтинговая система

- Средний рейтинг врача рассчитывается на основе всех отзывов (внутренние + внешние)
- Средний рейтинг клиники рассчитывается на основе всех отзывов (внутренние + внешние)
- Отображение:
  - Средний рейтинг (звезды + число, например 4.3)
  - Общее количество отзывов
  - Распределение по звездам (histogram: 5★ - 10, 4★ - 5, ...)
  - Средние оценки по критериям (если есть)
- Рейтинг обновляется в реальном времени

### FR-7: Модерация отзывов

- Все новые отзывы имеют статус "Pending" до модерации
- Модератор может:
  - Одобрить отзыв (статус "Approved")
  - Отклонить отзыв (статус "Rejected") с указанием причины
  - Запросить правки (пользователь получает уведомление)
- Отклоненные отзывы не отображаются публично
- Верификационные файлы проверяются модератором вручную
- Модератор может:
  - Одобрить верификацию (отзыв получает статус "Verified")
  - Отклонить верификацию (отзыв остается "Internal")

### FR-8: Управление своими отзывами

- Пользователь может видеть список своих отзывов в профиле
- Отображается:
  - Врач/клиника
  - Дата создания
  - Оценка
  - Статус (Pending/Approved/Rejected/Verified)
  - Кнопка "Редактировать" (если < 7 дней с момента создания)
  - Кнопка "Удалить"
- Удаление отзыва - мягкое (soft delete), отзыв остается в БД, но не отображается

---

## 2.2 Нефункциональные требования

### NFR-1: Производительность

- Загрузка страницы с отзывами < 2 секунд
- AI Summary генерируется асинхронно (не блокирует отображение отзывов)
- Пагинация отзывов оптимизирована (lazy loading)
- Рейтинг кэшируется и обновляется при изменении отзывов

### NFR-2: Безопасность

- Только авторизованные пользователи могут оставлять отзывы
- Пользователь может редактировать/удалять только свои отзывы
- Верификационные файлы доступны только модераторам
- Защита от спама (rate limiting: max 1 отзыв в час)
- Защита от XSS атак (санитизация текста отзывов)

### NFR-3: Доступность

- Отзывы доступны на всех языках интерфейса
- AI Summary локализован
- Responsive дизайн (мобильные устройства)
- Доступность для screen readers (a11y)

### NFR-4: Масштабируемость

- Система должна поддерживать 10,000+ отзывов
- База данных оптимизирована (индексы)
- AI Summary использует кэширование
- Внешние отзывы могут добавляться массово (bulk import)

### NFR-5: Качество данных

- Текст отзыва должен быть осмысленным (минимум 10 символов)
- Модерация для предотвращения оскорблений и клеветы
- Ограничение на частоту отзывов (1 отзыв на врача/клинику)
- Soft delete для сохранения истории

---

## 2.3 Scope (что включено / что НЕ включено)

### ✅ Включено

**Базовый функционал:**

- Создание внутренних отзывов (текст + оценка)
- Оценка по нескольким критериям
- Отображение отзывов на страницах врачей и клиник
- Сортировка и фильтрация отзывов
- Рейтинговая система (средний рейтинг, распределение)

**Верификация:**

- Загрузка файлов верификации (чеки, назначения)
- Ручная проверка модератором
- Verified badge для подтвержденных отзывов

**Внешние отзывы:**

- Импорт внешних отзывов суперадмином
- Указание источника (Facebook, Google Maps, и т.д.)
- Участие внешних отзывов в расчете рейтинга

**AI Summary:**

- Автоматический анализ всех отзывов
- Выделение ключевых положительных и негативных моментов
- Рекомендации для потенциальных пациентов
- Локализация AI Summary

**Модерация:**

- Модерация новых отзывов
- Проверка верификационных файлов
- Причины отклонения отзывов

**Управление:**

- Просмотр своих отзывов в профиле
- Редактирование отзывов (в течение 7 дней)
- Удаление своих отзывов

### ❌ НЕ включено (out of scope)

**Следующие версии:**

- Ответы врачей/клиник на отзывы
- Система жалоб на отзывы
- Полезность отзывов (лайки/дислайки)
- Фотографии к отзывам
- Автоматический импорт внешних отзывов (API интеграции)
- OCR для автоматического распознавания чеков
- Уведомления пользователей о новых отзывах
- Рекомендации врачей/клиник на основе отзывов

**Никогда:**

- Анонимные отзывы (требуется авторизация)

---

**Предыдущий раздел:** [← 1. Обзор](01-overview.md)  
**Следующий раздел:** [3. Архитектура →](03-architecture.md)
